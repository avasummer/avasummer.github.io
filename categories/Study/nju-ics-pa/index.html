<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#54C8C4" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 7.3.0">
<link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
<link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin>
  <link rel="apple-touch-icon" sizes="180x180" href="/images/180pixil-frame-0.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/32pixil-frame-0.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/16pixil-frame-0.png">
  <link rel="mask-icon" href="/images/pixil-frame-0.png.svg" color="#54C8C4">

<style>:root{--body-bg-color:#eee;--content-bg-color:#fff;--card-bg-color:#f5f5f5;--text-color:#555;--selection-bg:#262a30;--selection-color:#eee;--blockquote-color:#666;--link-color:#555;--link-hover-color:#222;--brand-color:#fff;--brand-hover-color:#fff;--table-row-odd-bg-color:#f9f9f9;--table-row-hover-bg-color:#f5f5f5;--menu-item-bg-color:#f5f5f5;--theme-color:#54c8c4;--btn-default-bg:#fff;--btn-default-color:#555;--btn-default-border-color:#555;--btn-default-hover-bg:#222;--btn-default-hover-color:#fff;--btn-default-hover-border-color:#222;--highlight-background:#f3f3f3;--highlight-foreground:#444;--highlight-gutter-background:#e1e1e1;--highlight-gutter-foreground:#555;color-scheme:light}@media (prefers-color-scheme:dark){:root{--body-bg-color:#282828;--content-bg-color:#333;--card-bg-color:#555;--text-color:#ccc;--selection-bg:#bbb;--selection-color:#333;--blockquote-color:#bbb;--link-color:#ccc;--link-hover-color:#eee;--brand-color:#ddd;--brand-hover-color:#ddd;--table-row-odd-bg-color:#282828;--table-row-hover-bg-color:#363636;--menu-item-bg-color:#555;--theme-color:#222;--btn-default-bg:#222;--btn-default-color:#ccc;--btn-default-border-color:#555;--btn-default-hover-bg:#666;--btn-default-hover-color:#ccc;--btn-default-hover-border-color:#666;--highlight-background:#1c1b1b;--highlight-foreground:#fff;--highlight-gutter-background:#323131;--highlight-gutter-foreground:#e8e8e8;color-scheme:dark}img{opacity:.75}img:hover{opacity:.9}iframe{color-scheme:light}}html{-webkit-text-size-adjust:100%;line-height:1.15}body{margin:0}main{display:block}h1{margin:.67em 0;font-size:2em}hr{box-sizing:content-box;height:0;overflow:visible}pre{font-family:monospace;font-size:1em}a{background:0 0}abbr[title]{border-bottom:none;text-decoration:underline dotted}b,strong{font-weight:bolder}code,kbd,samp{font-family:monospace;font-size:1em}small{font-size:80%}sub,sup{vertical-align:baseline;font-size:75%;line-height:0;position:relative}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:100%;line-height:1.15}button,input{overflow:visible}button,select{text-transform:none}button,[type=button],[type=reset],[type=submit]{-webkit-appearance:button}button::-moz-focus-inner,[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner{border-style:none;padding:0}button:-moz-focusring,[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring{outline:1px dotted buttontext}fieldset{padding:.35em .75em .625em}legend{box-sizing:border-box;color:inherit;white-space:normal;max-width:100%;padding:0;display:table}progress{vertical-align:baseline}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}details{display:block}summary{display:list-item}template,[hidden]{display:none}::selection{background:var(--selection-bg);color:var(--selection-color)}html,body{height:100%}body{background:var(--body-bg-color);box-sizing:border-box;color:var(--text-color);min-height:100%;font-family:Lato,PingFang SC,Microsoft YaHei,sans-serif;font-size:1em;line-height:2;transition:padding .2s ease-in-out;position:relative}h1,h2,h3,h4,h5,h6{margin:30px 0 15px;font-family:Lato,PingFang SC,Microsoft YaHei,sans-serif;font-weight:700;line-height:1.5}h1{font-size:1.5em}h2{font-size:1.375em}h3{font-size:1.25em}h4{font-size:1.125em}h5{font-size:1em}h6{font-size:.875em}a{color:var(--link-color);cursor:pointer;overflow-wrap:break-word;border-bottom:1px solid #999;outline:0;text-decoration:none}a:hover{border-bottom-color:var(--link-hover-color);color:var(--link-hover-color)}iframe,img,video,embed{max-width:100%;margin-left:auto;margin-right:auto;display:block}hr{background-image:repeating-linear-gradient(-45deg,#ddd,#ddd 4px,#0000 4px 8px);border:0;height:3px;margin:40px 0}blockquote{color:var(--blockquote-color);border-left:4px solid #ddd;margin:0;padding:0 15px}blockquote cite:before{content:"-";padding:0 5px}dt{font-weight:700}dd{margin:0;padding:0}.table-container{overflow:auto}table{border-collapse:collapse;border-spacing:0;width:100%;margin:0 0 20px;font-size:.875em}tbody tr:nth-of-type(odd){background:var(--table-row-odd-bg-color)}tbody tr:hover{background:var(--table-row-hover-bg-color)}caption,th,td{padding:8px}th,td{border:1px solid #ddd;border-bottom-width:3px}th{padding-bottom:10px;font-weight:700}td{border-bottom-width:1px}.btn{background:var(--btn-default-bg);border:2px solid var(--btn-default-border-color);color:var(--btn-default-color);border-radius:2px;padding:0 20px;font-size:.875em;line-height:2;transition:background-color .2s ease-in-out;display:inline-block}.btn:hover{background:var(--btn-default-hover-bg);border-color:var(--btn-default-hover-border-color);color:var(--btn-default-hover-color)}.btn+.btn{margin:0 0 8px 8px}.btn .fa-fw{text-align:left;width:1.28571em}.toggle{line-height:0}.toggle .toggle-line{background:#fff;width:100%;height:2px;transition:left .4s,opacity .4s,top .4s,transform .4s,width .4s;display:block;position:relative;top:0;left:0}.toggle .toggle-line:first-child{margin-top:1px}.toggle .toggle-line:not(:first-child){margin-top:4px}.toggle.toggle-arrow :first-child{width:50%;top:2px;left:50%;transform:rotate(45deg)}.toggle.toggle-arrow :last-child{width:50%;top:-2px;left:50%;transform:rotate(-45deg)}.toggle.toggle-close :nth-child(2){opacity:0}.toggle.toggle-close :first-child{top:6px;transform:rotate(45deg)}.toggle.toggle-close :last-child{top:-6px;transform:rotate(-45deg)}pre code.hljs{padding:1em;display:block;overflow-x:auto}code.hljs{padding:3px 5px}.hljs{color:#444;background:#f3f3f3}.hljs-comment{color:#697070}.hljs-tag,.hljs-punctuation{color:#444a}.hljs-tag .hljs-name,.hljs-tag .hljs-attr{color:#444}.hljs-keyword,.hljs-attribute,.hljs-selector-tag,.hljs-meta .hljs-keyword,.hljs-doctag,.hljs-name{font-weight:700}.hljs-type,.hljs-string,.hljs-number,.hljs-selector-id,.hljs-selector-class,.hljs-quote,.hljs-template-tag,.hljs-deletion{color:#800}.hljs-title,.hljs-section{color:#800;font-weight:700}.hljs-regexp,.hljs-symbol,.hljs-variable,.hljs-template-variable,.hljs-link,.hljs-selector-attr,.hljs-operator,.hljs-selector-pseudo{color:#ab5656}.hljs-literal{color:#695}.hljs-built_in,.hljs-bullet,.hljs-code,.hljs-addition{color:#397300}.hljs-meta{color:#1f7199}.hljs-meta .hljs-string{color:#38a}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}@media (prefers-color-scheme:dark){pre code.hljs{padding:1em;display:block;overflow-x:auto}code.hljs{padding:3px 5px}.hljs{color:#fff;background:#1c1b1b}.hljs-subst{color:#fff}.hljs-comment{color:#999}.hljs-keyword,.hljs-selector-tag,.hljs-meta .hljs-keyword,.hljs-doctag,.hljs-section,.hljs-attr{color:#88aece}.hljs-attribute{color:#c59bc1}.hljs-name,.hljs-type,.hljs-number,.hljs-selector-id,.hljs-quote,.hljs-template-tag{color:#f08d49}.hljs-selector-class{color:#88aece}.hljs-string,.hljs-regexp,.hljs-symbol,.hljs-variable,.hljs-template-variable,.hljs-link,.hljs-selector-attr{color:#b5bd68}.hljs-meta,.hljs-selector-pseudo{color:#88aece}.hljs-built_in,.hljs-title,.hljs-literal{color:#f08d49}.hljs-bullet,.hljs-code{color:#ccc}.hljs-meta .hljs-string{color:#b5bd68}.hljs-deletion{color:#de7176}.hljs-addition{color:#76c490}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}}.highlight:hover .copy-btn,.code-container:hover .copy-btn{opacity:1}.code-container{position:relative}.code-lang{opacity:.1;pointer-events:none;font-size:40px;line-height:1;position:absolute;right:5px}.copy-btn{color:#333;cursor:pointer;opacity:0;background-color:#eee;background-image:linear-gradient(#fcfcfc,#eee);border:1px solid #d5d5d5;border-radius:3px;padding:2px 6px;font-size:.8125em;line-height:1.6;transition:opacity .2s ease-in-out;position:absolute;top:8px;right:4px}code,kbd,figure.highlight,pre{background:var(--highlight-background);color:var(--highlight-foreground)}figure.highlight,pre{margin:0 auto 20px;line-height:1.6}figure.highlight figcaption,pre .caption{background:var(--highlight-gutter-background);color:var(--highlight-foreground);padding:.5em;font-size:.875em;line-height:1.2;display:flow-root}figure.highlight figcaption a,pre .caption a{color:var(--highlight-foreground);float:right}figure.highlight figcaption a:hover,pre .caption a:hover{border-bottom-color:var(--highlight-foreground)}pre,code{font-family:consolas,Menlo,monospace,PingFang SC,Microsoft YaHei}code{overflow-wrap:break-word;border-radius:3px;padding:2px 4px;font-size:.875em}kbd{white-space:nowrap;border:2px solid #ccc;border-radius:.2em;padding:.1em .3em;font-family:inherit;box-shadow:.1em .1em .2em #0000001a}figure.highlight{position:relative;overflow:auto}figure.highlight pre{border:0;margin:0;padding:10px 0}figure.highlight table{border:0;width:auto;margin:0}figure.highlight td{border:0;padding:0}figure.highlight .gutter{-webkit-user-select:none;user-select:none}figure.highlight .gutter pre{background:var(--highlight-gutter-background);color:var(--highlight-gutter-foreground);text-align:right;padding-left:10px;padding-right:10px}figure.highlight .code pre{width:100%;padding-left:10px}figure.highlight .marked{background:#0000004d}pre .caption{margin-bottom:10px}.gist table{width:auto}.gist table td{border:0}pre{padding:10px;overflow:auto}pre code{text-shadow:none;background:0 0;padding:0}.blockquote-center{text-align:center;border-left:0;margin:40px 0;padding:0;position:relative}.blockquote-center:before,.blockquote-center:after{opacity:.6;width:100%;line-height:1;position:absolute;left:0}.blockquote-center:before{text-align:left;content:"";border-top:1px solid #ccc;font-family:"Font Awesome 6 Free";font-weight:900;top:-20px}.blockquote-center:after{text-align:right;content:"";border-bottom:1px solid #ccc;font-family:"Font Awesome 6 Free";font-weight:900;bottom:-20px}.blockquote-center p,.blockquote-center div{text-align:center}.group-picture{margin-bottom:20px}.group-picture .group-picture-row{gap:3px;margin-bottom:3px;display:flex}.group-picture .group-picture-column{flex:1}.group-picture .group-picture-column img{object-fit:cover;width:100%;height:100%;margin:0}.post-body .label{color:#555;padding:0 2px}.post-body .label.default{background:#f0f0f0}.post-body .label.primary{background:#efe6f7}.post-body .label.info{background:#e5f2f8}.post-body .label.success{background:#e7f4e9}.post-body .label.warning{background:#fcf6e1}.post-body .label.danger{background:#fae8eb}.post-body .link-grid{grid-gap:1.5rem;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:1.5rem;margin-bottom:20px;padding:1rem;display:grid}.post-body .link-grid .link-grid-container{border:solid #ddd;min-width:0;min-height:5rem;padding:.5rem;transition:background .3s;position:relative;box-shadow:1rem 1rem .5rem #00000080}.post-body .link-grid .link-grid-container:hover{background:var(--card-bg-color);animation:.5s next-shake}.post-body .link-grid .link-grid-container:active{transform:translate(.2rem,.2rem);box-shadow:.5rem .5rem .25rem #00000080}.post-body .link-grid .link-grid-container .link-grid-image{box-sizing:border-box;border:1px solid #ddd;border-radius:50%;width:5rem;height:5rem;padding:3px;position:absolute}.post-body .link-grid .link-grid-container p{margin:0 1rem 0 6rem}.post-body .link-grid .link-grid-container p:first-of-type{font-size:1.2em}.post-body .link-grid .link-grid-container p:last-of-type{opacity:.7;font-size:.8em;line-height:1.3rem}.post-body .link-grid .link-grid-container a{border:0;width:100%;height:100%;position:absolute;top:0;left:0}@keyframes next-shake{0%{transform:translate(1pt,1pt)rotate(0)}10%{transform:translate(-1pt,-2pt)rotate(-1deg)}20%{transform:translate(-3pt)rotate(1deg)}30%{transform:translate(3pt,2pt)rotate(0)}40%{transform:translate(1pt,-1pt)rotate(1deg)}50%{transform:translate(-1pt,2pt)rotate(-1deg)}60%{transform:translate(-3pt,1pt)rotate(0)}70%{transform:translate(3pt,1pt)rotate(-1deg)}80%{transform:translate(-1pt,-1pt)rotate(1deg)}90%{transform:translate(1pt,2pt)rotate(0)}to{transform:translate(1pt,-2pt)rotate(-1deg)}}.post-body .note{background:#f5f5f5;border:1px solid #0000;border-radius:3px;margin-bottom:20px;padding:1em;position:relative}.post-body .note summary{cursor:pointer;outline:0}.post-body .note summary p{display:inline}.post-body .note h2,.post-body .note h3,.post-body .note h4,.post-body .note h5,.post-body .note h6{border-bottom:initial;margin:0;padding-top:0}.post-body .note :first-child{margin-top:0}.post-body .note :last-child{margin-bottom:0}.post-body .note:not(.no-icon){padding-left:2.5em}.post-body .note:not(.no-icon):before{font-size:1.5em;position:absolute;top:calc(50% - 1em);left:.3em}.post-body .note.default{color:#666;background:#f3f3f3;border-color:#e1e1e1}.post-body .note.default a:not(.btn){color:#666;border-bottom-color:#666}.post-body .note.default a:not(.btn):hover{color:#454545;border-bottom-color:#454545}@media (prefers-color-scheme:dark){.post-body .note.default{color:#dbdbdb;background:#525252;border-color:#585858}.post-body .note.default a:not(.btn){color:#dbdbdb;border-bottom-color:#dbdbdb}.post-body .note.default a:not(.btn):hover{color:#f8f8f8;border-bottom-color:#f8f8f8}}.post-body .note.default:not(.no-icon):before{content:"";font-family:"Font Awesome 6 Free";font-weight:900}.post-body .note.primary{color:#6f42c1;background:#f3daff;border-color:#e1c2ff}.post-body .note.primary a:not(.btn){color:#6f42c1;border-bottom-color:#6f42c1}.post-body .note.primary a:not(.btn):hover{color:#453298;border-bottom-color:#453298}@media (prefers-color-scheme:dark){.post-body .note.primary{color:#e4abff;background:#5b3e92;border-color:#503aaf}.post-body .note.primary a:not(.btn){color:#e4abff;border-bottom-color:#e4abff}.post-body .note.primary a:not(.btn):hover{color:#f7f0ff;border-bottom-color:#f7f0ff}}.post-body .note.primary:not(.no-icon):before{content:"";font-family:"Font Awesome 6 Free";font-weight:900}.post-body .note.info{color:#31708f;background:#d9edf7;border-color:#b3e5ef}.post-body .note.info a:not(.btn){color:#31708f;border-bottom-color:#31708f}.post-body .note.info a:not(.btn):hover{color:#215761;border-bottom-color:#215761}@media (prefers-color-scheme:dark){.post-body .note.info{color:#b3dbef;background:#2f576b;border-color:#2b707d}.post-body .note.info a:not(.btn){color:#b3dbef;border-bottom-color:#b3dbef}.post-body .note.info a:not(.btn):hover{color:#ecf8fb;border-bottom-color:#ecf8fb}}.post-body .note.info:not(.no-icon):before{content:"";font-family:"Font Awesome 6 Free";font-weight:900}.post-body .note.success{color:#3c763d;background:#dff0d8;border-color:#d0e6be}.post-body .note.success a:not(.btn){color:#3c763d;border-bottom-color:#3c763d}.post-body .note.success a:not(.btn):hover{color:#32562c;border-bottom-color:#32562c}@media (prefers-color-scheme:dark){.post-body .note.success{color:#c4e3b7;background:#355935;border-color:#416f39}.post-body .note.success a:not(.btn){color:#c4e3b7;border-bottom-color:#c4e3b7}.post-body .note.success a:not(.btn):hover{color:#f3f9ef;border-bottom-color:#f3f9ef}}.post-body .note.success:not(.no-icon):before{content:"";font-family:"Font Awesome 6 Free";font-weight:900}.post-body .note.warning{color:#8a6d3b;background:#fcf4e3;border-color:#fae4cd}.post-body .note.warning a:not(.btn){color:#8a6d3b;border-bottom-color:#8a6d3b}.post-body .note.warning a:not(.btn):hover{color:#714f30;border-bottom-color:#714f30}@media (prefers-color-scheme:dark){.post-body .note.warning{color:#f7e3b8;background:#685535;border-color:#89603a}.post-body .note.warning a:not(.btn){color:#f7e3b8;border-bottom-color:#f7e3b8}.post-body .note.warning a:not(.btn):hover{color:#fef8f3;border-bottom-color:#fef8f3}}.post-body .note.warning:not(.no-icon):before{content:"";font-family:"Font Awesome 6 Free";font-weight:900}.post-body .note.danger{color:#a94442;background:#f2dfdf;border-color:#ebcdd2}.post-body .note.danger a:not(.btn){color:#a94442;border-bottom-color:#a94442}.post-body .note.danger a:not(.btn):hover{color:#84333f;border-bottom-color:#84333f}@media (prefers-color-scheme:dark){.post-body .note.danger{color:#e5bebe;background:#7f3e3d;border-color:#9c3c4a}.post-body .note.danger a:not(.btn){color:#e5bebe;border-bottom-color:#e5bebe}.post-body .note.danger a:not(.btn):hover{color:#faf2f4;border-bottom-color:#faf2f4}}.post-body .note.danger:not(.no-icon):before{content:"";font-family:"Font Awesome 6 Free";font-weight:900}.post-body .tabs{margin-bottom:20px}.post-body .tabs,.tabs-comment{padding-top:10px}.post-body .tabs ul.nav-tabs,.tabs-comment ul.nav-tabs{background:var(--content-bg-color);z-index:5;flex-wrap:wrap;justify-content:center;margin:0;padding:0;display:flex;position:sticky;top:0}@media (width<=413px){.post-body .tabs ul.nav-tabs,.tabs-comment ul.nav-tabs{margin-bottom:5px;display:block}}.post-body .tabs ul.nav-tabs li.tab,.tabs-comment ul.nav-tabs li.tab{border:1px solid #0000;border-top-width:3px;border-bottom-color:#ddd;border-radius:0;flex-grow:1;list-style-type:none}@media (width<=413px){.post-body .tabs ul.nav-tabs li.tab,.tabs-comment ul.nav-tabs li.tab{border:1px solid #0000;border-left-width:3px;border-radius:0}}.post-body .tabs ul.nav-tabs li.tab a,.tabs-comment ul.nav-tabs li.tab a{border-bottom:initial;text-align:center;padding:.25em .75em;line-height:1.8;transition:all .2s ease-out;display:block}.post-body .tabs ul.nav-tabs li.tab a i[class^=fa],.tabs-comment ul.nav-tabs li.tab a i[class^=fa]{width:1.28571em}.post-body .tabs ul.nav-tabs li.tab.active,.tabs-comment ul.nav-tabs li.tab.active{border-color:#fc6423 #ddd #0000}@media (width<=413px){.post-body .tabs ul.nav-tabs li.tab.active,.tabs-comment ul.nav-tabs li.tab.active{border-color:#ddd #ddd #ddd #fc6423}}.post-body .tabs ul.nav-tabs li.tab.active a,.tabs-comment ul.nav-tabs li.tab.active a{cursor:default}.post-body .tabs .tab-content,.tabs-comment .tab-content{border:1px solid #ddd;border-top-color:#0000;border-radius:0}@media (width<=413px){.post-body .tabs .tab-content,.tabs-comment .tab-content{border-top-color:#ddd;border-radius:0}}.post-body .tabs .tab-content .tab-pane,.tabs-comment .tab-content .tab-pane{padding:20px 20px 0}.post-body .tabs .tab-content .tab-pane:not(.active),.tabs-comment .tab-content .tab-pane:not(.active){display:none}.pagination .prev,.pagination .next,.pagination .page-number,.pagination .space{margin:-1px 10px 0;padding:0 10px;display:inline-block}@media (width<=767px){.pagination .prev,.pagination .next,.pagination .page-number,.pagination .space{margin:0 5px}}.pagination .page-number.current{color:var(--content-bg-color);background:#ccc;border-color:#ccc}.pagination{text-align:center;border-top:1px solid #eee;margin:120px 0 0}.pagination .prev,.pagination .next,.pagination .page-number{border-top:1px solid #eee;border-bottom:0;transition:border-color .2s ease-in-out}.pagination .prev:hover,.pagination .next:hover,.pagination .page-number:hover{border-top-color:var(--link-hover-color)}@media (width<=767px){.pagination{border-top:0}.pagination .prev,.pagination .next,.pagination .page-number{border-top:0;border-bottom:1px solid #eee}.pagination .prev:hover,.pagination .next:hover,.pagination .page-number:hover{border-bottom-color:var(--link-hover-color)}}.pagination .space{margin:0;padding:0}.comments{margin-top:60px;overflow:hidden}.comment-button-group{flex-wrap:wrap;justify-content:center;margin:1em 0;display:flex}.comment-button-group .comment-button{margin:.1em .2em}.comment-button-group .comment-button.active{background:var(--btn-default-hover-bg);border-color:var(--btn-default-hover-border-color);color:var(--btn-default-hover-color)}.comment-position{display:none}.comment-position.active{display:block}.tabs-comment{margin-top:4em;padding-top:0}.tabs-comment .comments{margin-top:0;padding-top:0}.headband{background:var(--theme-color);height:3px}@media (width<=991px){.headband{display:none}}.site-brand-container{flex-shrink:0;padding:0 10px;display:flex}.use-motion .column,.use-motion .site-brand-container .toggle{opacity:0}.site-meta{text-align:center;flex-grow:1}@media (width<=767px){.site-meta{text-align:center}}.custom-logo-image{margin-top:20px}@media (width<=991px){.custom-logo-image{display:none}}.brand{color:var(--brand-color);border-bottom:0;padding:0;display:inline-block}.brand:hover{color:var(--brand-hover-color)}.site-title{margin:0;font-family:Noto Serif SC,Lato,PingFang SC,Microsoft YaHei,sans-serif;font-size:1.375em;font-weight:400;line-height:1.5}.site-subtitle{color:#ddd;margin:10px 10px 0;font-size:.8125em}.use-motion .site-title,.use-motion .site-subtitle,.use-motion .custom-logo-image{opacity:0;position:relative;top:-10px}.site-nav-toggle,.site-nav-right{display:none}@media (width<=767px){.site-nav-toggle,.site-nav-right{flex-direction:column;justify-content:center;display:flex}}.site-nav-toggle .toggle,.site-nav-right .toggle{color:var(--text-color);width:22px;padding:10px}.site-nav-toggle .toggle .toggle-line,.site-nav-right .toggle .toggle-line{background:var(--text-color);border-radius:1px}@media (width<=767px){.site-nav{--scroll-height:0;visibility:hidden;height:0;transition:height .2s ease-in-out,visibility .2s ease-in-out;overflow:hidden}body:not(.site-nav-on) .site-nav .animated{animation:none}body.site-nav-on .site-nav{height:var(--scroll-height);visibility:unset}}.menu{text-align:center;margin:0;padding:1em 0}.menu-item{margin:0 10px;list-style:none;display:inline-block}@media (width<=767px){.menu-item{margin-top:10px;display:block}.menu-item.menu-item-search{display:none}}.menu-item a{border-bottom:0;font-size:.8125em;transition:border-color .2s ease-in-out;display:block}.menu-item a:hover,.menu-item a.menu-item-active{background:var(--menu-item-bg-color)}.menu-item i[class^=fa]{margin-right:8px}.menu-item .badge{color:var(--content-bg-color);text-shadow:1px 1px #0000001a;background:#ccc;border-radius:10px;margin-left:.35em;padding:2px 5px;font-weight:700;line-height:1}.use-motion .menu-item{visibility:hidden}@media (width<=991px){.sidebar{left:-320px}.sidebar-active .sidebar{left:0}.sidebar{z-index:20;background:#222;width:320px;max-height:100vh;transition:left .2s ease-out,right .2s ease-out;position:fixed;top:0;bottom:0;overflow-y:auto;box-shadow:inset 0 2px 6px #000}.sidebar a{color:#999;border-bottom-color:#555}.sidebar a:hover{color:#eee;border-bottom-color:#eee}.links-of-author:not(:first-child){margin-top:15px}.links-of-author a{vertical-align:middle;border-bottom-color:#555;margin-bottom:10px;margin-right:10px;display:inline-block}.links-of-author a:before{content:" ";background:#afe501;border-radius:50%;width:4px;height:4px;margin-right:3px;display:inline-block;transform:translateY(-2px)}.links-of-blogroll-item{padding:0 5px}.popular-posts .popular-posts-item .popular-posts-link:hover{background:0 0}.sidebar-dimmer{opacity:0;visibility:hidden;z-index:10;background:#000;width:100%;height:100%;transition:visibility .4s,opacity .4s;position:fixed;top:0;left:0}.sidebar-active .sidebar-dimmer{opacity:.7;visibility:visible}}.sidebar-inner{color:#999;text-align:center;flex-direction:column;justify-content:center;padding:18px 10px;display:flex}.sidebar-toggle{cursor:pointer;opacity:.6;z-index:30;background:#222;width:16px;height:16px;padding:5px;position:fixed;bottom:61px;left:30px}@media (width<=991px){.sidebar-toggle{left:20px}}.sidebar-toggle:hover{opacity:.8}@media (width<=991px){.sidebar-toggle{opacity:.8}}.sidebar-toggle:hover .toggle-line{background:#fc6423}@media (any-hover:hover){body:not(.sidebar-active) .sidebar-toggle:hover :first-child{width:50%;top:2px;left:50%;transform:rotate(45deg)}body:not(.sidebar-active) .sidebar-toggle:hover :last-child{width:50%;top:-2px;left:50%;transform:rotate(-45deg)}}.sidebar-active .sidebar-toggle :nth-child(2){opacity:0}.sidebar-active .sidebar-toggle :first-child{top:6px;transform:rotate(45deg)}.sidebar-active .sidebar-toggle :last-child{top:-6px;transform:rotate(-45deg)}.sidebar-nav{pointer-events:none;visibility:hidden;height:0;margin:0;padding-left:0;font-size:.875em;transition:height .2s ease-in-out,visibility .2s ease-in-out;overflow:hidden}.sidebar-nav-active .sidebar-nav{pointer-events:unset;height:calc(2em + 1px);visibility:unset}.sidebar-nav li{color:var(--text-color);cursor:pointer;border-bottom:1px solid #0000;transition:border-bottom-color .2s ease-in-out,color .2s ease-in-out;display:inline-block}.sidebar-nav li.sidebar-nav-overview{margin-left:10px}.sidebar-nav li:hover{color:#fc6423}.sidebar-toc-active .sidebar-nav-toc,.sidebar-overview-active .sidebar-nav-overview{color:#fc6423;border-bottom-color:#fc6423;transition-delay:.2s}.sidebar-toc-active .sidebar-nav-toc:hover,.sidebar-overview-active .sidebar-nav-overview:hover{color:#fc6423}.sidebar-panel-container{flex:1;align-items:start;padding-top:0;transition:padding-top .2s ease-in-out;display:grid;overflow:hidden auto}.sidebar-nav-active .sidebar-panel-container{padding-top:20px}.sidebar-panel{opacity:0;pointer-events:none;visibility:hidden;grid-area:1/1;height:0;transition:opacity .2s ease-in-out,transform .2s ease-in-out,visibility .2s ease-in-out;animation:.2s ease-in-out deactivate-sidebar-panel;overflow:hidden;transform:translateY(0)}.sidebar-nav-active .sidebar-panel,.sidebar-overview-active .sidebar-panel.post-toc-wrap{transform:translateY(-20px)}.sidebar-overview-active:not(.sidebar-nav-active) .sidebar-panel.post-toc-wrap{transition-delay:0s,.2s,0s}.sidebar-overview-active .sidebar-panel.site-overview-wrap,.sidebar-toc-active .sidebar-panel.post-toc-wrap{opacity:1;pointer-events:unset;height:auto;visibility:unset;transition-delay:.2s,.2s,0s;animation-name:activate-sidebar-panel;transform:translateY(0)}.sidebar-panel.site-overview-wrap{flex-direction:column;justify-content:flex-start;gap:10px;display:flex}@keyframes deactivate-sidebar-panel{0%{height:var(--inactive-panel-height,0)}to{height:var(--active-panel-height,0)}}@keyframes activate-sidebar-panel{0%{height:var(--inactive-panel-height,auto)}to{height:var(--active-panel-height,auto)}}.post-toc{font-size:.875em}.post-toc ol{text-align:left;margin:0;padding:0 2px 0 10px;list-style:none}.post-toc ol>:last-child{margin-bottom:5px}.post-toc ol>ol{padding-left:0}.post-toc ol a{transition:all .2s ease-in-out}.post-toc .nav-item{text-overflow:ellipsis;white-space:nowrap;line-height:1.8;overflow:hidden}.post-toc .nav .nav-child{--height:0;opacity:0;visibility:hidden;height:0;transition:all .2s ease-in-out;overflow:hidden}.post-toc .nav .active>.nav-child{height:var(--height,auto);opacity:1;visibility:unset}.post-toc .nav .active>a{color:#fc6423;border-bottom-color:#fc6423}.post-toc .nav .active-current>a,.post-toc .nav .active-current>a:hover{color:#fc6423}.site-author-image{border:1px solid #eee;max-width:120px;padding:2px}.site-author-name{color:var(--text-color);margin:0;font-weight:600}.site-description{color:#999;margin-top:0;font-size:.8125em}.sidebar .sidebar-button:not(:first-child){margin-top:15px}.sidebar .sidebar-button button{color:#fc6423;cursor:pointer;background:0 0;border:1px solid #fc6423;border-radius:4px;padding:0 15px;line-height:2}.sidebar .sidebar-button button:hover{color:#fff;background:#fc6423}.sidebar .sidebar-button button i[class^=fa]{margin-right:5px}.links-of-author a{font-size:.8125em}.cc-license .cc-opacity{opacity:.7;border-bottom:0}.cc-license .cc-opacity:hover{opacity:.9}.cc-license img{display:inline-block}.links-of-blogroll{font-size:.8125em}.links-of-blogroll-title{font-size:.875em;font-weight:600}.links-of-blogroll-list{flex-flow:column wrap;justify-content:center;gap:5px;margin:5px 0 0;padding:0;list-style:none;display:flex}.links-of-blogroll-item{max-width:100%}.links-of-blogroll-item a{box-sizing:border-box;text-overflow:ellipsis;white-space:nowrap;max-width:100%;display:inline-block;overflow:hidden}.footer{color:#999;padding:20px 0;font-size:.875em;transition:left .2s ease-in-out,right .2s ease-in-out}.footer.footer-fixed{position:absolute;bottom:0;left:0;right:0}.footer-inner{box-sizing:border-box;text-align:center;flex-direction:column;justify-content:center;width:calc(100% - 20px);margin:0 auto;display:flex}@media (width<=767px){.footer-inner{width:auto}}@media (width>=1200px){.footer-inner{width:1160px}}@media (width>=1600px){.footer-inner{width:73%}}.use-motion .footer{opacity:0}.languages{font-size:1.125em;display:inline-block;position:relative}.languages .lang-select-label span{margin:0 .5em}.languages .lang-select{opacity:0;width:100%;height:100%;position:absolute;top:0;left:0}.with-love{color: ;margin:0 5px;display:inline-block}@keyframes icon-animate{0%,to{transform:scale(1)}10%,30%{transform:scale(.9)}20%,40%,60%,80%{transform:scale(1.1)}50%,70%{transform:scale(1.1)}}@media (width<=567px){.main-inner{padding:initial!important}.posts-expand .post-header{margin-bottom:10px!important}.post-block{margin-top:initial!important;padding:8px 18px!important}.post-body h1,.post-body h2,.post-body h3,.post-body h4,.post-body h5,.post-body h6{margin:20px 0 8px}.post-body .note h1,.post-body .tabs .tab-content .tab-pane h1,.post-body .note h2,.post-body .tabs .tab-content .tab-pane h2,.post-body .note h3,.post-body .tabs .tab-content .tab-pane h3,.post-body .note h4,.post-body .tabs .tab-content .tab-pane h4,.post-body .note h5,.post-body .tabs .tab-content .tab-pane h5,.post-body .note h6,.post-body .tabs .tab-content .tab-pane h6{margin:0 5px}.post-body>p{margin:0 0 10px}.post-body .note>p,.post-body .tabs .tab-content .tab-pane>p{padding:0 5px}.post-body img,.post-body video{margin-bottom:10px!important}.post-body figure:not(.highlight) figcaption{margin:-5px auto 15px!important}.post-body .note{margin-bottom:10px!important;padding:10px!important}.post-body .note:not(.no-icon){padding-left:35px!important}.post-body .tabs .tab-content .tab-pane{padding:10px 10px 0!important}.post-eof{margin:40px auto 20px!important}.pagination{margin-top:40px}}.back-to-top{color:#fff;cursor:pointer;opacity:.6;z-index:30;background:#222;align-items:center;height:26px;font-size:12px;transition:bottom .2s ease-in-out;display:flex;position:fixed;bottom:-100px;left:30px}.back-to-top span{margin-right:8px;display:none}.back-to-top .fa{text-align:center;width:26px}@media (width<=991px){.back-to-top{left:20px}}.back-to-top:hover{opacity:.8}@media (width<=991px){.back-to-top{opacity:.8}}.back-to-top:hover{color:#fc6423}.back-to-top.back-to-top-on{bottom:30px}.reading-progress-bar{--progress:0;z-index:50;height:3px;width:var(--progress);background:#b49df8;position:fixed;top:0;left:0}.rtl.post-body p,.rtl.post-body a,.rtl.post-body h1,.rtl.post-body h2,.rtl.post-body h3,.rtl.post-body h4,.rtl.post-body h5,.rtl.post-body h6,.rtl.post-body li,.rtl.post-body ul,.rtl.post-body ol{direction:rtl;font-family:UKIJ Ekran}.rtl.post-title{font-family:UKIJ Ekran}.post-button{text-align:center;margin-top:40px}.use-motion .post-block,.use-motion .pagination,.use-motion .comments,.use-motion .post-header,.use-motion .post-body{visibility:hidden}.posts-collapse .post-content{margin-bottom:35px;margin-left:35px;position:relative}@media (width<=767px){.posts-collapse .post-content{margin-left:0;margin-right:0}}.posts-collapse .post-content .collection-title{font-size:1.125em;position:relative}.posts-collapse .post-content .collection-title:before{content:" ";background:#999;border:1px solid #fff;border-radius:50%;width:10px;height:10px;margin-top:-4px;margin-left:-6px;position:absolute;top:50%}.posts-collapse .post-content .collection-year{margin:60px 0;font-size:1.5em;font-weight:700;position:relative}.posts-collapse .post-content .collection-year .collection-year-count{color:var(--content-bg-color);text-shadow:1px 1px #0000001a;background:#ccc;border-radius:10px;margin-left:.35em;padding:2px 5px;font-size:.75em;font-weight:700;line-height:1}.posts-collapse .post-content .collection-year:before{content:" ";background:#bbb;border-radius:50%;width:8px;height:8px;margin-top:-4px;margin-left:-4px;position:absolute;top:50%}.posts-collapse .post-content .collection-header{margin-left:20px;display:block}.posts-collapse .post-content .collection-header small{color:#bbb;margin-left:5px}.posts-collapse .post-content .post-header{border-bottom:1px dashed #ccc;margin:30px 2px 0;padding-left:15px;transition:border .2s ease-in-out;position:relative}.posts-collapse .post-content .post-header:before{content:" ";background:#bbb;border:1px solid #fff;border-radius:50%;width:6px;height:6px;transition:background .2s ease-in-out;position:absolute;top:.75em;left:-6px}.posts-collapse .post-content .post-header:hover{border-bottom-color:#666}.posts-collapse .post-content .post-header:hover:before{background:#222}.posts-collapse .post-content .post-meta-container{margin-right:10px;font-size:.75em;display:inline}.posts-collapse .post-content .post-title{display:inline}.posts-collapse .post-content .post-title a{color:var(--link-color);border-bottom:0}.posts-collapse .post-content .post-title .fa{margin-left:5px;font-size:.875em}.posts-collapse .post-content:before{content:" ";background:#f5f5f5;width:4px;height:100%;margin-left:-2px;position:absolute;top:1.25em}.post-body{overflow-wrap:break-word;font-family:Lato,PingFang SC,Microsoft YaHei,sans-serif}@media (width>=1200px){.post-body{font-size:1.125em}}@media (width>=992px){.post-body{text-align:justify}}@media (width<=991px){.post-body{text-align:justify}}.post-body h1 .header-anchor,.post-body h2 .header-anchor,.post-body h3 .header-anchor,.post-body h4 .header-anchor,.post-body h5 .header-anchor,.post-body h6 .header-anchor,.post-body h1 .headerlink,.post-body h2 .headerlink,.post-body h3 .headerlink,.post-body h4 .headerlink,.post-body h5 .headerlink,.post-body h6 .headerlink{color:inherit;float:right;opacity:0;border-bottom-style:none;margin-left:10px;font-size:.875em}.post-body h1 .header-anchor:before,.post-body h2 .header-anchor:before,.post-body h3 .header-anchor:before,.post-body h4 .header-anchor:before,.post-body h5 .header-anchor:before,.post-body h6 .header-anchor:before,.post-body h1 .headerlink:before,.post-body h2 .headerlink:before,.post-body h3 .headerlink:before,.post-body h4 .headerlink:before,.post-body h5 .headerlink:before,.post-body h6 .headerlink:before{content:"";font-family:"Font Awesome 6 Free";font-weight:900}.post-body h1:hover .header-anchor,.post-body h2:hover .header-anchor,.post-body h3:hover .header-anchor,.post-body h4:hover .header-anchor,.post-body h5:hover .header-anchor,.post-body h6:hover .header-anchor,.post-body h1:hover .headerlink,.post-body h2:hover .headerlink,.post-body h3:hover .headerlink,.post-body h4:hover .headerlink,.post-body h5:hover .headerlink,.post-body h6:hover .headerlink{opacity:.5}.post-body h1:hover .header-anchor:hover,.post-body h2:hover .header-anchor:hover,.post-body h3:hover .header-anchor:hover,.post-body h4:hover .header-anchor:hover,.post-body h5:hover .header-anchor:hover,.post-body h6:hover .header-anchor:hover,.post-body h1:hover .headerlink:hover,.post-body h2:hover .headerlink:hover,.post-body h3:hover .headerlink:hover,.post-body h4:hover .headerlink:hover,.post-body h5:hover .headerlink:hover,.post-body h6:hover .headerlink:hover{opacity:1}.post-body .exturl .fa{margin-left:4px;font-size:.875em}.post-body figure:not(.highlight) figcaption{color:#999;text-align:center;margin:-15px auto 15px;font-size:.875em;font-weight:700;line-height:1}.post-body iframe,.post-body img,.post-body video,.post-body embed{margin-bottom:20px}.post-body .video-container{width:100%;height:0;margin-bottom:20px;padding-top:75%;position:relative;overflow:hidden}.post-body .video-container iframe,.post-body .video-container object,.post-body .video-container embed{width:100%;height:100%;margin:0;position:absolute;top:0;left:0}.post-gallery{min-height:200px;display:flex}.post-gallery .post-gallery-image{flex:1}.post-gallery .post-gallery-image:not(:first-child){clip-path:polygon(40px 0,100% 0,100% 100%,0 100%);margin-left:-20px}.post-gallery .post-gallery-image:not(:last-child){margin-right:-20px}.post-gallery .post-gallery-image img{object-fit:cover;opacity:1;width:100%;height:100%}.posts-expand .post-gallery{margin-bottom:60px}.posts-collapse .post-gallery{margin:15px 0}.posts-expand .post-header{text-align:center;margin-bottom:60px;font-size:1.125em}.posts-expand .post-title{margin:initial;overflow-wrap:break-word;font-size:1.5em;font-weight:400}.posts-expand .post-title-link{color:var(--link-color);border-bottom:0;max-width:100%;display:inline-block;position:relative}.posts-expand .post-title-link:before{background:var(--link-color);content:"";width:100%;height:2px;transition:transform .2s ease-in-out;position:absolute;bottom:0;left:0;transform:scaleX(0)}.posts-expand .post-title-link:hover:before{transform:scaleX(1)}.posts-expand .post-title-link .fa{margin-left:5px;font-size:.875em}.post-sticky-flag{margin-right:8px;display:inline-block;transform:rotate(30deg)}.posts-expand .post-meta-container{color:#999;margin-top:3px;font-family:Lato,PingFang SC,Microsoft YaHei,sans-serif;font-size:.75em}.posts-expand .post-meta-container .post-description{margin-top:2px;font-size:.875em}.posts-expand .post-meta-container time{border-bottom:1px dashed #999}.post-meta{flex-wrap:wrap;justify-content:center;display:flex}:not(.post-meta-break)+.post-meta-item:before{content:"|";margin:0 .5em}.post-meta-item-icon{margin-right:3px}@media (width<=991px){.post-meta-item-text{display:none}}.post-meta-break{flex-basis:100%;height:0}.post-nav{border-top:1px solid #eee;justify-content:space-between;gap:30px;margin-top:1em;padding:10px 5px 0;display:flex}.post-nav-item{flex:1}.post-nav-item a{border-bottom:0;font-size:.875em;line-height:1.6;display:block}.post-nav-item a:active{top:2px}.post-nav-item .fa{font-size:.75em}.post-nav-item:first-child .fa{margin-right:5px}.post-nav-item:last-child{text-align:right}.post-nav-item:last-child .fa{margin-left:5px}.post-footer{flex-direction:column;justify-content:center;display:flex}.post-eof{background:#ccc;width:8%;height:1px;margin:80px auto 60px}.post-block:last-of-type .post-eof{display:none}.post-tags{text-align:center;margin-top:40px}.post-tags a{font-size:.8125em;display:inline-block}.post-tags a:not(:last-child){margin-right:10px}.social-like{border-top:1px solid #eee;flex-wrap:wrap;justify-content:center;margin-top:1em;padding-top:1em;font-size:.875em;display:flex}.social-like a{border-bottom:none}.reward-container{text-align:center;margin:1em 0 0;padding:1em 0}.reward-container button{color:#fc6423;cursor:pointer;vertical-align:text-top;background:0 0;border:2px solid #fc6423;border-radius:2px;outline:0;padding:0 15px;line-height:2}.reward-container button:hover{color:#fff;background:#fc6423}.post-reward{padding-top:20px;display:none}.post-reward.active{display:block}.post-reward div{display:inline-block}.post-reward div span{display:block}.post-reward img{width:180px;max-width:100%;margin:.8em 2em 0;display:inline-block}@keyframes next-roll{0%{transform:rotate(30deg)}to{transform:rotate(-30deg)}}.category-all-page .category-all-title{text-align:center}.category-all-page .category-all{margin-top:20px}.category-all-page .category-list{margin:0;padding:0;list-style:none}.category-all-page .category-list-item{margin:5px 10px}.category-all-page .category-list-count{color:var(--content-bg-color);text-shadow:1px 1px #0000001a;background:#ccc;border-radius:10px;margin-left:.35em;padding:2px 5px;font-size:.75em;font-weight:700;line-height:1}.category-all-page .category-list-child{padding-left:10px}.event-list hr{background:#222;margin:20px 0 45px}.event-list hr:after{color:#fff;content:"NOW";background:#222;padding:0 5px;font-weight:700;display:inline-block}.event-list .event{--event-background:#222;--event-foreground:#bbb;--event-title:#fff;background:var(--event-background);padding:15px}.event-list .event .event-summary{color:var(--event-title);border-bottom:0;margin:0;padding:0 0 0 35px;position:relative}.event-list .event .event-summary:before{background:var(--event-title);content:" ";border-radius:50%;width:12px;height:12px;margin-top:-6px;animation:1s ease-in-out infinite alternate dot-flash;position:absolute;top:50%;left:0}.event-list .event:nth-of-type(odd) .event-summary:before{animation-delay:.5s}.event-list .event:not(:last-child){margin-bottom:20px}.event-list .event .event-relative-time{color:var(--event-foreground);padding-left:12px;font-size:12px;font-weight:400;display:inline-block}.event-list .event .event-details{color:var(--event-foreground);padding:6px 0 6px 35px;line-height:18px;display:block}.event-list .event .event-details:before{color:var(--event-foreground);width:14px;margin-right:9px;font-family:"Font Awesome 6 Free";font-weight:900;display:inline-block}.event-list .event .event-details.event-location:before{content:""}.event-list .event .event-details.event-duration:before{content:""}.event-list .event .event-details.event-description:before{content:""}.event-list .event-past{--event-background:#f5f5f5;--event-foreground:#999;--event-title:#222}@keyframes dot-flash{0%{opacity:1;transform:scale(1)}to{opacity:0;transform:scale(.8)}}ul.breadcrumb{text-align:center;margin:1em 0;padding:0 2em;font-size:.75em;list-style:none}ul.breadcrumb li{display:inline}ul.breadcrumb li:not(:first-child):before{content:"/ ";padding:.5em;font-weight:400}ul.breadcrumb li:last-child{font-weight:700}.tag-cloud{text-align:center}.tag-cloud a{margin:10px;display:inline-block}.tag-cloud-0{color:#aaa;border-bottom-color:#aaa}.tag-cloud-1{color:#9a9a9a;border-bottom-color:#9a9a9a}.tag-cloud-2{color:#8b8b8b;border-bottom-color:#8b8b8b}.tag-cloud-3{color:#7c7c7c;border-bottom-color:#7c7c7c}.tag-cloud-4{color:#6c6c6c;border-bottom-color:#6c6c6c}.tag-cloud-5{color:#5d5d5d;border-bottom-color:#5d5d5d}.tag-cloud-6{color:#4e4e4e;border-bottom-color:#4e4e4e}.tag-cloud-7{color:#3e3e3e;border-bottom-color:#3e3e3e}.tag-cloud-8{color:#2f2f2f;border-bottom-color:#2f2f2f}.tag-cloud-9{color:#202020;border-bottom-color:#202020}.tag-cloud-10{color:#111;border-bottom-color:#111}@media (prefers-color-scheme:dark){.tag-cloud-0{color:#555;border-bottom-color:#555}.tag-cloud-1{color:#646464;border-bottom-color:#646464}.tag-cloud-2{color:#737373;border-bottom-color:#737373}.tag-cloud-3{color:#828282;border-bottom-color:#828282}.tag-cloud-4{color:#929292;border-bottom-color:#929292}.tag-cloud-5{color:#a1a1a1;border-bottom-color:#a1a1a1}.tag-cloud-6{color:#b0b0b0;border-bottom-color:#b0b0b0}.tag-cloud-7{color:silver;border-bottom-color:silver}.tag-cloud-8{color:#cfcfcf;border-bottom-color:#cfcfcf}.tag-cloud-9{color:#dedede;border-bottom-color:#dedede}.tag-cloud-10{color:#eee;border-bottom-color:#eee}}.search-active{margin-right:var(--dialog-scrollgutter,0);overflow:hidden}.search-pop-overlay{visibility:hidden;z-index:40;background:0 0;width:100%;height:100%;transition:visibility .4s,background .4s;display:flex;position:fixed;top:0;left:0}.search-active .search-pop-overlay{visibility:visible;background:#0000004d}.search-popup{background:var(--card-bg-color);border-radius:5px;width:700px;height:80%;margin:auto;transition:transform .4s;transform:scale(0)}.search-active .search-popup{transform:scale(1)}@media (width<=767px){.search-popup{border-radius:0;width:100%;height:100%}}.search-popup .search-icon,.search-popup .popup-btn-close{color:#999;padding:0 10px;font-size:18px}.search-popup .popup-btn-close{cursor:pointer}.search-popup .popup-btn-close:hover .fa{color:#222}.search-popup .search-header{background:#eee;border-top-left-radius:5px;border-top-right-radius:5px;padding:5px;display:flex}@media (prefers-color-scheme:dark){.search-popup .search-header{background:#666}}.search-popup input.search-input{background:0 0;border:0;outline:0;width:100%}.search-popup input.search-input::-webkit-search-cancel-button{display:none}.search-popup .search-result-container{flex-direction:column;height:calc(100% - 55px);padding:5px 25px;display:flex;overflow:auto}.search-popup .search-result-container hr{flex-shrink:0;margin:5px 0 10px}.search-popup .search-result-container hr:first-child{display:none}.search-popup .search-result-list{margin:0 5px;padding:0}.search-popup a.search-result-title{font-weight:700}.search-popup p.search-result{border-bottom:1px dashed #ccc;margin:0 0 10px;padding:5px 0}.search-popup .search-input-container{flex-grow:1;padding:2px}.search-popup .search-result-icon{color:#ccc;margin:auto}mark.search-keyword{color:#ff2a2a;background:0 0;border-bottom:1px dashed #ff2a2a;font-weight:700}mjx-container[jax=CHTML][display=true],.has-jax{overflow:auto hidden}mjx-container[display=true]+br{display:none}.use-motion .animated{visibility:inherit;animation-fill-mode:none}.use-motion .sidebar .animated{animation-fill-mode:both}header.header{background:var(--content-bg-color);border-radius:initial;box-shadow:0 2px 2px #0000001f,0 3px 1px -2px #0000000f,0 1px 5px #0000001f}@media (width<=991px){header.header{border-radius:initial}}.main{justify-content:space-between;align-items:stretch;width:calc(100% - 20px);margin:0 auto;display:flex}@media (width<=767px){.main{width:auto}}@media (width>=1200px){.main{width:1160px}}@media (width>=1600px){.main{width:73%}}@media (width<=991px){.main{width:auto;display:block}}.main-inner{border-radius:initial;box-sizing:border-box;width:calc(100% - 252px)}@media (width<=991px){.main-inner{border-radius:initial;width:100%}}.footer-inner{padding-left:252px}@media (width<=991px){.footer-inner{width:auto;padding-left:0;padding-right:0}}.column{width:240px}@media (width<=991px){.column{width:auto}}.site-brand-container{background:var(--theme-color)}@media (width<=991px){.site-nav-on .site-brand-container{box-shadow:0 0 16px #00000080}}.site-meta{padding:20px 0}@media (width>=768px) and (width<=991px){.site-nav-toggle,.site-nav-right{flex-direction:column;justify-content:center;display:flex}}.site-nav-toggle .toggle,.site-nav-right .toggle{color:#fff}.site-nav-toggle .toggle .toggle-line,.site-nav-right .toggle .toggle-line{background:#fff}@media (width>=768px) and (width<=991px){.site-nav{--scroll-height:0;visibility:hidden;height:0;transition:height .2s ease-in-out,visibility .2s ease-in-out;overflow:hidden}body:not(.site-nav-on) .site-nav .animated{animation:none}body.site-nav-on .site-nav{height:var(--scroll-height);visibility:unset}}.menu .menu-item{margin:0;display:block}.menu .menu-item a{align-items:center;padding:5px 20px;transition-property:background-color;display:flex;position:relative}.menu .menu-item a .badge{margin-left:auto}@media (width<=991px){.menu .menu-item.menu-item-search{display:none}}.main-menu .menu-item-active:after{content:" ";background:#bbb;border-radius:50%;width:6px;height:6px;margin-top:-3px;position:absolute;top:50%;right:15px}.sub-menu{margin:0;padding:6px 0}.sub-menu .menu-item{display:inline-block}.sub-menu .menu-item a{padding:initial;background:0 0;margin:5px 10px}.sub-menu .menu-item a:hover{color:#fc6423;background:0 0}.sub-menu .menu-item-active{color:#fc6423;border-bottom-color:#fc6423}.sub-menu .menu-item-active:hover{border-bottom-color:#fc6423}@media (width>=992px){.sidebar{position:sticky;top:12px}.sidebar-toggle{display:none}.sidebar-inner{background:var(--content-bg-color);border-radius:initial;box-sizing:border-box;color:var(--text-color);max-height:calc(100vh - 24px);margin-top:12px;box-shadow:0 2px 2px #0000001f,0 3px 1px -2px #0000000f,0 1px 5px #0000001f,0 -1px .5px #00000017}.site-state-item{padding:0 10px}.sidebar .sidebar-button{border-top:1px dotted #ccc;border-bottom:1px dotted #ccc}.sidebar .sidebar-button button{color:#fc6423;border:0;width:100%;display:block}.sidebar .sidebar-button button:hover{color:#e34603;background:0 0;border:0}.links-of-author{flex-wrap:wrap;justify-content:center;display:flex}.links-of-author-item{margin:5px 0 0}.links-of-author-item a{box-sizing:border-box;text-overflow:ellipsis;white-space:nowrap;border-bottom:0;border-radius:4px;max-width:100%;padding:0 5px;display:inline-block;overflow:hidden}.links-of-author-item a:hover{background:var(--body-bg-color)}.links-of-blogroll-item a{padding:0 5px}}.main-inner .sub-menu,.main-inner .post-block,.main-inner .tabs-comment,.main-inner>.comments,.main-inner .comment-position .comments,.main-inner .pagination{background:var(--content-bg-color);border-radius:initial;box-shadow:0 2px 2px #0000001f,0 3px 1px -2px #0000000f,0 1px 5px #0000001f}.main-inner .post-block:not(:first-child):not(:first-child){border-radius:initial;margin-top:12px;box-shadow:0 2px 2px #0000001f,0 3px 1px -2px #0000000f,0 1px 5px #0000001f,0 -1px .5px #00000017}@media (width>=768px) and (width<=991px){.main-inner .post-block:not(:first-child):not(:first-child){margin-top:10px}}@media (width<=767px){.main-inner .post-block:not(:first-child):not(:first-child){margin-top:8px}}.main-inner .tabs-comment,.main-inner>.comments,.main-inner .comment-position .comments,.main-inner .pagination{border-radius:initial;margin-top:12px;box-shadow:0 2px 2px #0000001f,0 3px 1px -2px #0000000f,0 1px 5px #0000001f,0 -1px .5px #00000017}@media (width>=768px) and (width<=991px){.main-inner .tabs-comment,.main-inner>.comments,.main-inner .comment-position .comments,.main-inner .pagination{margin-top:10px}}@media (width<=767px){.main-inner .tabs-comment,.main-inner>.comments,.main-inner .comment-position .comments,.main-inner .pagination{margin-top:8px}}.post-block,.comments{padding:40px}.post-eof{display:none}.pagination{border-top:initial;padding:10px 0}.post-body h1,.post-body h2{border-bottom:1px solid #eee}.post-body h3{border-bottom:1px dotted #eee}@media (width>=768px) and (width<=991px){.main-inner{padding:10px}.posts-expand .post-button{margin-top:20px}.post-block{padding:20px}.comments{padding:10px 20px}}@media (width<=767px){.main-inner{padding:8px}.posts-expand .post-button{margin:12px 0}.post-block{padding:12px}.comments{padding:10px 12px}}</style>

<link rel="preload" href="https://fonts.googleapis.com/css2?family=Lato:ital,wght@0,300;0,400;0,700;1,300;1,400;1,700&family=Noto+Serif+SC:ital,wght@0,300;0,400;0,700;1,300;1,400;1,700&display=swap&subset=latin,latin-ext" as="style" onload="this.rel='stylesheet'">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" integrity="sha256-dABdfBfUoC8vJUBOwGVdm8L9qlMWaHTIfXt+7GnZCIo=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"summ2.link","root":"/","images":"/images","scheme":"Gemini","darkmode":true,"version":"8.23.1","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":false,"codeblock":{"theme":{"light":"default","dark":"stackoverflow-dark"},"prism":{"light":"prism","dark":"prism-dark"},"copy_button":{"enable":"mac","style":null},"fold":{"enable":false,"height":500}},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":true,"transition":{"menu_item":"fadeIn","post_block":"fadeIn","post_header":"fadeIn","post_body":"fadeIn"}},"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.json","localsearch":{"enable":true,"top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js" defer></script>

    <meta name="description" content="Do you know 本人代码水平拙劣🥲，实现部分仅供参考">
<meta property="og:type" content="article">
<meta property="og:title" content="NJU ICS PA 一些笔记">
<meta property="og:url" content="http://summ2.link/categories/Study/nju-ics-pa/index.html">
<meta property="og:site_name" content="House of summ2r">
<meta property="og:description" content="Do you know 本人代码水平拙劣🥲，实现部分仅供参考">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://summ2.link/PA1/image-20250702170516999.png">
<meta property="og:image" content="http://summ2.link/PA1/image-20250701151239011.png">
<meta property="og:image" content="http://summ2.link/PA1/image-20250702170516999.png">
<meta property="og:image" content="http://summ2.link/PA1/68747470733a2f2f692e696d6775722e636f6d2f4169394f714f422e706e67.png">
<meta property="article:published_time" content="2025-03-31T16:00:00.000Z">
<meta property="article:modified_time" content="2025-09-27T16:00:00.000Z">
<meta property="article:author" content="summ2">
<meta property="article:tag" content="ICS">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://summ2.link/PA1/image-20250702170516999.png">


<link rel="canonical" href="http://summ2.link/categories/Study/nju-ics-pa/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"http://summ2.link/categories/Study/nju-ics-pa/","path":"categories/Study/nju-ics-pa/","title":"NJU ICS PA 一些笔记"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>NJU ICS PA 一些笔记 | House of summ2r</title>
  








  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous" defer></script>
<script src="/js/utils.js" defer></script><script src="/js/motion.js" defer></script><script src="/js/sidebar.js" defer></script><script src="/js/next-boot.js" defer></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous" defer></script>
<script src="/js/third-party/search/local-search.js" defer></script>







  




  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="/js/third-party/math/mathjax.js" defer></script>



  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<link rel="alternate" href="/atom.xml" title="House of summ2r" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">House of summ2r</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa-solid fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa-solid fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-rss"><a href="/atom.xml" rel="section"><i class="fa fa-rss fa-fw"></i>RSS</a></li><li class="menu-item menu-item-links"><a href="/links/" rel="section"><i class="fa-solid fa-link fa-fw"></i>友链</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
      <div class="search-header">
        <span class="search-icon">
          <i class="fa fa-search"></i>
        </span>
        <div class="search-input-container">
          <input autocomplete="off" autocapitalize="off" maxlength="80"
                placeholder="搜索..." spellcheck="false"
                type="search" class="search-input">
        </div>
        <span class="popup-btn-close" role="button">
          <i class="fa fa-times-circle"></i>
        </span>
      </div>
      <div class="search-result-container">
        <div class="search-result-icon">
          <i class="fa fa-spinner fa-pulse fa-5x"></i>
        </div>
      </div>
    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#pa1---%E5%BC%80%E5%A4%A9%E8%BE%9F%E5%9C%B0%E7%9A%84%E7%AF%87%E7%AB%A0"><span class="nav-number">1.</span> <span class="nav-text">PA1 - 开天辟地的篇章</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#rtfsc"><span class="nav-number">1.1.</span> <span class="nav-text">RTFSC</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%9B%91%E8%A7%86%E7%82%B9"><span class="nav-number">1.2.</span> <span class="nav-text">监视点</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9F%BA%E6%9C%AC%E6%A1%86%E6%9E%B6"><span class="nav-number">1.2.1.</span> <span class="nav-text">基本框架</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%93%BE%E8%A1%A8%E7%BB%B4%E6%8A%A4"><span class="nav-number">1.2.2.</span> <span class="nav-text">链表维护</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9B%91%E8%A7%86%E7%82%B9%E6%B1%82%E5%80%BC"><span class="nav-number">1.2.3.</span> <span class="nav-text">监视点求值</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%A6%82%E4%BD%95%E9%98%85%E8%AF%BB%E6%89%8B%E5%86%8C"><span class="nav-number">1.3.</span> <span class="nav-text">如何阅读手册</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%A8%8B%E5%BA%8F%E6%98%AF%E4%B8%AA%E7%8A%B6%E6%80%81%E6%9C%BA"><span class="nav-number">1.3.1.</span> <span class="nav-text">程序是个状态机</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%90%86%E8%A7%A3%E5%9F%BA%E7%A1%80%E8%AE%BE%E6%96%BD"><span class="nav-number">1.3.2.</span> <span class="nav-text">理解基础设施</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#rtfm"><span class="nav-number">1.3.3.</span> <span class="nav-text">RTFM</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#riscv32%E6%9C%89%E5%93%AA%E5%87%A0%E7%A7%8D%E6%8C%87%E4%BB%A4%E6%A0%BC%E5%BC%8F"><span class="nav-number">1.3.3.1.</span> <span class="nav-text">riscv32 有哪几种指令格式？</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#lui%E6%8C%87%E4%BB%A4%E7%9A%84%E8%A1%8C%E4%B8%BA%E6%98%AF%E4%BB%80%E4%B9%88"><span class="nav-number">1.3.3.2.</span> <span class="nav-text">LUI 指令的行为是什么？</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#mstatus%E5%AF%84%E5%AD%98%E5%99%A8%E7%9A%84%E7%BB%93%E6%9E%84%E6%98%AF%E6%80%8E%E4%B9%88%E6%A0%B7%E7%9A%84"><span class="nav-number">1.3.3.3.</span> <span class="nav-text">mstatus 寄存器的结构是怎么样的？</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E4%BD%BF%E7%94%A8-wall%E5%92%8C-werror"><span class="nav-number">1.3.3.4.</span> <span class="nav-text">为什么要使用 -Wall 和 -Werror?</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#shell%E5%91%BD%E4%BB%A4"><span class="nav-number">1.3.4.</span> <span class="nav-text">shell 命令</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#pa2---%E7%AE%80%E5%8D%95%E5%A4%8D%E6%9D%82%E7%9A%84%E6%9C%BA%E5%99%A8"><span class="nav-number">2.</span> <span class="nav-text">PA2 - 简单复杂的机器</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%8D%E5%81%9C%E8%AE%A1%E7%AE%97%E7%9A%84%E6%9C%BA%E5%99%A8"><span class="nav-number">2.1.</span> <span class="nav-text">不停计算的机器</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%94%BB%E5%87%BA%E5%9C%A8yemu%E4%B8%8A%E6%89%A7%E8%A1%8C%E7%9A%84%E5%8A%A0%E6%B3%95%E7%A8%8B%E5%BA%8F%E7%9A%84%E7%8A%B6%E6%80%81%E6%9C%BA"><span class="nav-number">2.1.1.</span> <span class="nav-text">画出在 YEMU 上执行的加法程序的状态机</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#rtfsc2"><span class="nav-number">2.2.</span> <span class="nav-text">RTFSC(2)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AB%8B%E5%8D%B3%E6%95%B0%E8%83%8C%E5%90%8E%E7%9A%84%E6%95%85%E4%BA%8B"><span class="nav-number">2.2.1.</span> <span class="nav-text">立即数背后的故事</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AB%8B%E5%8D%B3%E6%95%B0%E8%83%8C%E5%90%8E%E7%9A%84%E6%95%85%E4%BA%8B2"><span class="nav-number">2.2.2.</span> <span class="nav-text">立即数背后的故事 (2)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#auipc%E7%9A%84%E6%89%A7%E8%A1%8C%E8%BF%87%E7%A8%8B"><span class="nav-number">2.2.3.</span> <span class="nav-text">auipc 的执行过程</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#instruction-fetch"><span class="nav-number">2.2.3.1.</span> <span class="nav-text">instruction fetch</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#instruction-decode"><span class="nav-number">2.2.3.2.</span> <span class="nav-text">instruction decode</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#execute"><span class="nav-number">2.2.3.3.</span> <span class="nav-text">execute</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%BF%90%E8%A1%8C%E7%AC%AC%E4%B8%80%E4%B8%AAc%E7%A8%8B%E5%BA%8F"><span class="nav-number">2.2.4.</span> <span class="nav-text">运行第一个 C 程序</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8C%87%E4%BB%A4%E5%90%8D%E5%AF%B9%E7%85%A7"><span class="nav-number">2.2.5.</span> <span class="nav-text">指令名对照</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%A8%8B%E5%BA%8F-%E8%BF%90%E8%A1%8C%E6%97%B6%E7%8E%AF%E5%A2%83%E4%B8%8Eam"><span class="nav-number">2.3.</span> <span class="nav-text">程序，运行时环境与 AM</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%BF%90%E8%A1%8C%E6%97%B6%E7%8E%AF%E5%A2%83"><span class="nav-number">2.3.1.</span> <span class="nav-text">运行时环境</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#rtfsc3"><span class="nav-number">2.3.2.</span> <span class="nav-text">RTFSC(3)</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%98%85%E8%AF%BBmakefile"><span class="nav-number">2.3.2.1.</span> <span class="nav-text">阅读 Makefile</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9E%E7%8E%B0%E5%B8%B8%E7%94%A8%E7%9A%84%E5%BA%93%E5%87%BD%E6%95%B0"><span class="nav-number">2.3.3.</span> <span class="nav-text">实现常用的库函数</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#stdarg%E6%98%AF%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E7%9A%84"><span class="nav-number">2.3.3.1.</span> <span class="nav-text">stdarg 是如何实现的？</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9F%BA%E7%A1%80%E8%AE%BE%E6%96%BD2"><span class="nav-number">2.3.4.</span> <span class="nav-text">基础设施 (2)</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%8C%87%E4%BB%A4%E7%8E%AF%E5%BD%A2%E7%BC%93%E5%86%B2%E5%8C%BA---iringbuf"><span class="nav-number">2.3.4.1.</span> <span class="nav-text">指令环形缓冲区 - iringbuf</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%87%BD%E6%95%B0%E8%B0%83%E7%94%A8%E7%9A%84%E8%B8%AA%E8%BF%B9---ftrace"><span class="nav-number">2.3.4.2.</span> <span class="nav-text">函数调用的踪迹 - ftrace</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#differential-testing"><span class="nav-number">2.3.4.3.</span> <span class="nav-text">Differential Testing</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%BE%93%E5%85%A5%E8%BE%93%E5%87%BA"><span class="nav-number">2.3.5.</span> <span class="nav-text">输入输出</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#references"><span class="nav-number">3.</span> <span class="nav-text">References</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">summ2</p>
  <div class="site-description" itemprop="description">keep it simple stupid >3</div>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/avasummer" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;avasummer" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:summ2 AT hdu.edu.cn" title="E-Mail → mailto:summ2 AT hdu.edu.cn" rel="noopener me" target="_blank"><i class="fa fa-envelope fa-fw"></i></a>
      </span>
  </div>
  <div class="cc-license animated" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/small/by_nc_sa.svg" alt="Creative Commons"></a>
  </div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://summ2.link/categories/Study/nju-ics-pa/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="summ2">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="House of summ2r">
      <meta itemprop="description" content="keep it simple stupid >3">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="NJU ICS PA 一些笔记 | House of summ2r">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          NJU ICS PA 一些笔记
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2025-04-01 00:00:00" itemprop="dateCreated datePublished" datetime="2025-04-01T00:00:00+08:00">2025-04-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2025-09-28 00:00:00" itemprop="dateModified" datetime="2025-09-28T00:00:00+08:00">2025-09-28</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Study/" itemprop="url" rel="index"><span itemprop="name">Study</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><div class="note info"><p><em>Do you know</em></p>
<p>本人代码水平拙劣🥲，实现部分仅供参考</p>
</div>
<span id="more"></span>
<p><a target="_blank" rel="noopener" href="https://nju-projectn.github.io/ics-pa-gitbook/ics2024/index.html">南京大学
计算机科学与技术系 计算机系统基础 课程实验 2024</a></p>
<h1 id="pa1---开天辟地的篇章">PA1 - 开天辟地的篇章</h1>
<h2 id="rtfsc">RTFSC</h2>
<p>文件：<code>nemu/src/monitor/sdb/sdb.c</code></p>
<p>原因：退出时 <code>nemu_state.state</code> 不是 “正常” 的</p>
<p>解决办法：</p>
<pre><code class="highlight c"><span class="type">static</span> <span class="type">int</span> <span class="title function_">cmd_q</span><span class="params">(<span class="type">char</span> *args)</span> {
  nemu_state.state = NEMU_QUIT;
  <span class="keyword">return</span> <span class="number">-1</span>;
}</code></pre>
<h2 id="监视点">监视点</h2>
<h3 id="基本框架">基本框架</h3>
<p>添加 <code>w &lt;expr&gt;</code> 和 <code>d &lt;index&gt;</code> 命令，来添加和删除监视点。</p>
<p>并且需要实现监视点池中链表的维护，监视点表达式的计算。</p>
<p>为了提高 NEMU 的性能，提供监视点功能的开关选项。</p>
<h3 id="链表维护">链表维护</h3>
<p>监视点池中涉及监视点链表和空闲链表，通过 <code>init_wp_pool()</code> 来对其初始化。</p>
<pre><code class="highlight c"><span class="type">void</span> <span class="title function_">init_wp_pool</span><span class="params">()</span> {
  <span class="type">int</span> i;
  <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; NR_WP; i ++) {
    wp_pool[i].NO = i;
    wp_pool[i].next = (i == NR_WP - <span class="number">1</span> ? <span class="literal">NULL</span> : &amp;wp_pool[i + <span class="number">1</span>]);
  }

  head = <span class="literal">NULL</span>;
  free_ = wp_pool;
}</code></pre>
<p>接着，通过 <code>new_wp()</code> 和 <code>free_wp()</code> 实现监视点的管理</p>
<pre><code class="highlight c"><span class="type">int</span> <span class="title function_">new_wp</span><span class="params">(<span class="type">char</span>* args)</span>{
  WP *p=<span class="literal">NULL</span>,*q=<span class="literal">NULL</span>;
  <span class="keyword">if</span> (free_==<span class="literal">NULL</span>)
  {
    <span class="built_in">printf</span>(<span class="string">"Watchpoints Limit"</span>);
    <span class="keyword">return</span> <span class="number">-1</span>;
  }
  p=free_;
  <span class="type">bool</span> success=<span class="number">1</span>;
  p-&gt;result = expr(args,&amp;success);
  <span class="keyword">if</span> (!success)<span class="keyword">return</span> <span class="number">-1</span>;
  p-&gt;expr = strdup(args);
  free_=free_-&gt;next;
  <span class="keyword">if</span> (head!=<span class="literal">NULL</span>)
  {
    q=head;
    <span class="keyword">while</span> (q-&gt;next!=<span class="literal">NULL</span>)q=q-&gt;next;
    q-&gt;next=p;
    <span class="keyword">return</span> <span class="number">1</span>;
  }
  head=p;
  head-&gt;next=<span class="literal">NULL</span>;
  <span class="keyword">return</span> <span class="number">1</span>;
}</code></pre>
<pre><code class="highlight c"><span class="type">void</span> <span class="title function_">free_wp</span><span class="params">(<span class="type">int</span> no)</span>
{
  <span class="keyword">if</span> (head==<span class="literal">NULL</span>)
  {
	<span class="built_in">printf</span>(<span class="string">"Watchpoint %d not found.\n"</span>,no);
    <span class="keyword">return</span>;
  }
  <span class="keyword">if</span> (head-&gt;NO==no)
  {
    WP *wp=head;
    head=wp-&gt;next;
    wp-&gt;next=free_;
    free_=wp;
    <span class="keyword">return</span>;
  }
  WP *p=<span class="literal">NULL</span>;
  <span class="keyword">if</span> (head!=<span class="literal">NULL</span>)
  {
    p=head;
    <span class="keyword">while</span> (<span class="number">1</span>){
      <span class="keyword">if</span> (p-&gt;next-&gt;NO==no){
        WP *wp=p-&gt;next;
        p-&gt;next=wp-&gt;next;
        wp-&gt;next=free_;
        free_=wp;
        <span class="keyword">return</span>;
      }
      <span class="keyword">if</span> (p-&gt;next==<span class="literal">NULL</span>)
      {
        <span class="built_in">printf</span>(<span class="string">"Watchpoint %d not found.\n"</span>,no);
        <span class="keyword">return</span>;
      }
      p=p-&gt;next;
    }
  }
}</code></pre>
<h3 id="监视点求值">监视点求值</h3>
<p>为了判断监视点的值是否发生变化，还需要在结构体中添加一个成员来记录。然后通过 <code>check_expr()</code> 来求值和判断变化。</p>
<pre><code class="highlight c"><span class="type">bool</span> <span class="title function_">check_expr</span><span class="params">()</span>{
  <span class="type">bool</span> changed=<span class="literal">false</span>;
  <span class="keyword">if</span> (head==<span class="literal">NULL</span>)<span class="keyword">return</span> <span class="number">0</span>;
  WP *p;
  <span class="type">bool</span> success=<span class="literal">true</span>;
  p=head;
  <span class="type">word_t</span> result = expr(p-&gt;expr,&amp;success);
  <span class="keyword">if</span> (result!=p-&gt;result &amp;&amp; success)
  {
    <span class="built_in">printf</span>(<span class="string">"Watchpoint %d changed at 0x%x.\n"</span>,p-&gt;NO,cpu.pc);
    changed=<span class="literal">true</span>;
  }
  <span class="keyword">if</span> (changed)<span class="keyword">return</span> <span class="number">1</span>;
  <span class="keyword">return</span> <span class="number">0</span>;
}</code></pre>
<h2 id="如何阅读手册">如何阅读手册</h2>
<h3 id="程序是个状态机">程序是个状态机</h3>
<p>对于计算 <code>1+2+...+100</code> 的程序的状态机，它是确定性的。</p>
<pre><code class="highlight plaintext">(0, x, x) -&gt; (1, 0, x) -&gt; (2, 0, 0) -&gt; (3, 0, 1) -&gt; (4, 1, 1) -&gt; (5, 1, 2) -&gt; (6, 3, 2) -&gt; ... -&gt; (199,4851, 99) -&gt; (200, 4950, 99) -&gt; (201, 4950, 100) -&gt; (202, 5050, 100)</code></pre>
<h3 id="理解基础设施">理解基础设施</h3>
<p>不必多说，使用过调试器的话肯定有所体会。</p>
<h3 id="rtfm">RTFM</h3>
<h4 id="riscv32有哪几种指令格式">riscv32 有哪几种指令格式？</h4>
<p>There are four core instruction formats.</p>
<p>Register-Type, Immediate-Type, Store-Type, Upper Immediate-Type.</p>
<h4 id="lui指令的行为是什么">LUI 指令的行为是什么？</h4>
<p>LUI (load upper immediate) is used to build 32-bit constants and uses
the U-type format. LUI places the 32-bit U-immediate value into the
destination register rd, filling in the lowest 12 bits with zeros.</p>
<figure>
<img src="/PA1/image-20250702170516999.png" alt="LUI">
<figcaption aria-hidden="true">LUI</figcaption>
</figure>
<h4 id="mstatus寄存器的结构是怎么样的">mstatus 寄存器的结构是怎么样的？</h4>
<p>The mstatus (Machine Status) register is an MXLEN-bit read/write
register formatted as shown in figures below. It's a <em>Control and
Status Register</em>.<img src="/PA1/image-20250701151239011.png" alt="mstatus"></p>
<h4 id="为什么要使用-wall和-werror">为什么要使用 <code>-Wall</code> 和 <code>-Werror</code>?</h4>
<p>At section 3.9, we found that:</p>
<p><code>-Werror</code> Turn all warnings into errors.</p>
<p><code>-Wall</code> This enables all the warnings about constructions
that some users consider questionable, and that are easy to avoid (or
modify to prevent the warning), even in conjunction with macros. This
also enables some language-specific warnings.</p>
<p>To add these options, we can leverage compilers to identify potential
issues in our programs.</p>
<h3 id="shell命令">shell 命令</h3>
<p>使用 <code>find . -type f \( -name "*.c" -o -name "*.h" \) -print0 | xargs -0 wc -l</code> 来统计行数</p>
<p>由于我环境经历了多次迁移，似乎把 git 弄坏了（</p>
<p>不过毕竟我没有提交作业的需求，就不注意这些细节了</p>
<h1 id="pa2---简单复杂的机器">PA2 - 简单复杂的机器</h1>
<h2 id="不停计算的机器">不停计算的机器</h2>
<h3 id="画出在yemu上执行的加法程序的状态机">画出在 YEMU 上执行的加法程序的状态机</h3>
<p>类似地，使用一个 6 元组来分别表示 PC, R [0], R [1], M [x], M [y], M [z].</p>
<pre><code class="highlight plaintext">(0, 0, 0, x, y ,0) -&gt; (1, y, 0, x, y, 0) -&gt; (2, y, y, x, y, 0) -&gt; (3, x, y , x, y, 0) -&gt; (4, x+y, y, x, y, 0) -&gt; (5, x+y, y, x, y, x+y)</code></pre>
<h2 id="rtfsc2">RTFSC(2)</h2>
<h3 id="立即数背后的故事">立即数背后的故事</h3>
<p>1. 假设我们需要将 NEMU 运行在 Motorola
68k 的机器上 (把 NEMU 的源代码编译成 Motorola 68k 的机器码)</p>
<p>此时读取的字节序列会被解释为大端序的，如果在二进制文件中以小端序存储，可能会导致问题。</p>
<p>2. 假设我们需要把 Motorola 68k 作为一个新的 ISA 加入到 NEMU 中</p>
<p>我们需要正确模拟大端序对应的存储结构与解释方式。</p>
<h3 id="立即数背后的故事2">立即数背后的故事 (2)</h3>
<p>在 RISC-V32 中，一般使用分部加载的方式：</p>
<p>通过 <code>lui</code> 加载高 20 位，<code>addi</code> 加载低 12 位</p>
<pre><code class="highlight assembly">lui x10, 0x0D000
addi x10, x10, 0x721</code></pre>
<h3 id="auipc的执行过程"><code>auipc</code> 的执行过程</h3>
<p>QEMU 内建的第一条指令，正是 <code>auipc</code></p>
<pre><code class="highlight plaintext">0x00000297,  // auipc t0,0</code></pre>
<p>在 QEMU 运行过程中，首先调用 <code>exec_once()</code> 来进入相应的处理流程。</p>
<pre><code class="highlight c"><span class="type">static</span> <span class="type">void</span> <span class="title function_">exec_once</span><span class="params">(Decode *s, <span class="type">vaddr_t</span> pc)</span> {
  s-&gt;pc = pc;
  s-&gt;snpc = pc;
  isa_exec_once(s);
  cpu.pc = s-&gt;dnpc;
  
<span class="comment">//some macros...</span>
}</code></pre>
<p>传入的 <code>Decode</code> 是一个包含与 PC 有关变量的结构体</p>
<pre><code class="highlight c"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">Decode</span> {</span>
  <span class="type">vaddr_t</span> pc;
  <span class="type">vaddr_t</span> snpc; <span class="comment">// static next pc</span>
  <span class="type">vaddr_t</span> dnpc; <span class="comment">// dynamic next pc</span>
  ISADecodeInfo isa;
  IFDEF(CONFIG_ITRACE, <span class="type">char</span> logbuf[<span class="number">128</span>]);
} Decode;</code></pre>
<p>然后调用 <code>isa_exec_once(s)</code>，对于不同的架构，具体的定义不同。</p>
<h4 id="instruction-fetch">instruction fetch</h4>
<p>在 risc-v32 的实现中，代码如下</p>
<pre><code class="highlight c"><span class="type">int</span> <span class="title function_">isa_exec_once</span><span class="params">(Decode *s)</span> {
  s-&gt;isa.inst = inst_fetch(&amp;s-&gt;snpc, <span class="number">4</span>);
  <span class="keyword">return</span> decode_exec(s);
}</code></pre>
<p>具体的过程又涉及到 <code>vaddr_read()</code> 和 <code>paddr_read()</code>，处理 mmio 地址和 pmem 地址，物理内存上使用 <code>host_read()</code> 读取主机内存上的不同长度字节。</p>
<h4 id="instruction-decode">instruction decode</h4>
<p>完成取指调用的一系列函数后，<code>isa_exec_once()</code> 会返回 <code>decode_exec(s)</code></p>
<p>将指令与相应的模式匹配</p>
<pre><code class="highlight c"><span class="type">static</span> <span class="type">int</span> <span class="title function_">decode_exec</span><span class="params">(Decode *s)</span> {
  s-&gt;dnpc = s-&gt;snpc;

<span class="meta">#<span class="keyword">define</span> INSTPAT_INST(s) ((s)-&gt;isa.inst)</span>
<span class="meta">#<span class="keyword">define</span> INSTPAT_MATCH(s, name, type, ... <span class="comment">/* execute body */</span> ) { \</span>
<span class="meta">  int rd = 0; \</span>
<span class="meta">  word_t src1 = 0, src2 = 0, imm = 0; \</span>
<span class="meta">  decode_operand(s, &amp;rd, &amp;src1, &amp;src2, &amp;imm, concat(TYPE_, type)); \</span>
<span class="meta">  __VA_ARGS__ ; \</span>
<span class="meta">}</span>

  INSTPAT_START();
  INSTPAT(<span class="string">"??????? ????? ????? ??? ????? 00101 11"</span>, auipc  , U, R(rd) = s-&gt;pc + imm);
  INSTPAT(<span class="string">"??????? ????? ????? 100 ????? 00000 11"</span>, lbu    , I, R(rd) = Mr(src1 + imm, <span class="number">1</span>));
  INSTPAT(<span class="string">"??????? ????? ????? 000 ????? 01000 11"</span>, sb     , S, Mw(src1 + imm, <span class="number">1</span>, src2));

  INSTPAT(<span class="string">"0000000 00001 00000 000 00000 11100 11"</span>, ebreak , N, NEMUTRAP(s-&gt;pc, R(<span class="number">10</span>))); <span class="comment">// R(10) is $a0</span>
  INSTPAT(<span class="string">"??????? ????? ????? ??? ????? ????? ??"</span>, inv    , N, INV(s-&gt;pc));
  INSTPAT_END();

  R(<span class="number">0</span>) = <span class="number">0</span>; <span class="comment">// reset $zero to 0</span>

  <span class="keyword">return</span> <span class="number">0</span>;
}</code></pre>
<p>其中，<code>auipc</code> 对应的 (U-Type) 格式如下：</p>
<figure>
<img src="/PA1/image-20250702170516999.png" alt="AUIPC">
<figcaption aria-hidden="true">AUIPC</figcaption>
</figure>
<h4 id="execute">execute</h4>
<p>QEMU 在宏中定义了 <code>auipc</code> 的具体行为：</p>
<pre><code class="highlight c">INSTPAT(<span class="string">"??????? ????? ????? ??? ????? 00101 11"</span>, auipc  , U, R(rd) = s-&gt;pc + imm);</code></pre>
<p><code>pattern_decode（）</code>中的宏处理了格式字符串：</p>
<pre><code class="highlight c"><span class="type">static</span> <span class="keyword">inline</span> <span class="type">void</span> <span class="title function_">pattern_decode</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *str, <span class="type">int</span> len,</span>
<span class="params">    <span class="type">uint64_t</span> *key, <span class="type">uint64_t</span> *mask, <span class="type">uint64_t</span> *shift)</span> {
  <span class="type">uint64_t</span> __key = <span class="number">0</span>, __mask = <span class="number">0</span>, __shift = <span class="number">0</span>;
<span class="meta">#<span class="keyword">define</span> macro(i) \</span>
<span class="meta">  <span class="keyword">if</span> ((i) &gt;= len) goto finish; \</span>
<span class="meta">  <span class="keyword">else</span> { \</span>
<span class="meta">    char c = str[i]; \</span>
<span class="meta">    <span class="keyword">if</span> (c != <span class="string">' '</span>) { \</span>
<span class="meta">      Assert(c == <span class="string">'0'</span> || c == <span class="string">'1'</span> || c == <span class="string">'?'</span>, \</span>
<span class="meta">          <span class="string">"invalid character '%c' in pattern string"</span>, c); \</span>
<span class="meta">      __key  = (__key  &lt;&lt; 1) | (c == <span class="string">'1'</span> ? 1 : 0); \</span>
<span class="meta">      __mask = (__mask &lt;&lt; 1) | (c == <span class="string">'?'</span> ? 0 : 1); \</span>
<span class="meta">      __shift = (c == <span class="string">'?'</span> ? __shift + 1 : 0); \</span>
<span class="meta">    } \</span>
<span class="meta">  }</span>

<span class="meta">#<span class="keyword">define</span> macro2(i)  macro(i);   macro((i) + 1)</span>
<span class="meta">#<span class="keyword">define</span> macro4(i)  macro2(i);  macro2((i) + 2)</span>
<span class="meta">#<span class="keyword">define</span> macro8(i)  macro4(i);  macro4((i) + 4)</span>
<span class="meta">#<span class="keyword">define</span> macro16(i) macro8(i);  macro8((i) + 8)</span>
<span class="meta">#<span class="keyword">define</span> macro32(i) macro16(i); macro16((i) + 16)</span>
<span class="meta">#<span class="keyword">define</span> macro64(i) macro32(i); macro32((i) + 32)</span>
  macro64(<span class="number">0</span>);<span class="comment">//宏展开，遍历了6位二进制数0b000000的任意取值</span>
  panic(<span class="string">"pattern too long"</span>);
<span class="meta">#<span class="keyword">undef</span> macro</span>
finish:
  *key = __key &gt;&gt; __shift;
  *mask = __mask &gt;&gt; __shift;
  *shift = __shift;
}</code></pre>
<h3 id="运行第一个c程序">运行第一个 C 程序</h3>
<p>我们需要在此部分实现的指令有 <code>lui</code>, <code>addi</code>,
<code>jal</code>, <code>jalr</code>.</p>
<p>按照 RISC-V 手册实现即可。</p>
<p>需要注意不同指令对待操作数的符号和截断处理。</p>
<h3 id="指令名对照">指令名对照</h3>
<p>方法很多，可以根据 <code>opcode</code> 段查询。</p>
<h2 id="程序-运行时环境与am">程序，运行时环境与 AM</h2>
<h3 id="运行时环境">运行时环境</h3>
<p>要求实现 <code>spirntf()</code> 等等库函数，可以参考 <code>glibc</code> 或者 STFW.</p>
<h3 id="rtfsc3">RTFSC(3)</h3>
<p>对各个 section 的定义如下</p>
<pre><code class="highlight c"><span class="comment">//abstract-machine/scripts/linker.ld</span>

ENTRY(_start)
PHDRS { text PT_LOAD; data PT_LOAD; }

SECTIONS {
  <span class="comment">/* _pmem_start and _entry_offset are defined in LDFLAGS */</span>
  . = _pmem_start + _entry_offset;
  .text : {
    *(entry)
    *(.text*)
  } : text
  etext = .;
  _etext = .;
  .rodata : {
    *(.rodata*)
  }
  .data : {
    *(.data)
  } : data
  edata = .;
  _data = .;
  .bss : {
	_bss_start = .;
    *(.bss*)
    *(.sbss*)
    *(.scommon)
  }
  _stack_top = ALIGN(<span class="number">0x1000</span>);
  . = _stack_top + <span class="number">0x8000</span>;
  _stack_pointer = .;
  end = .;
  _end = .;
  _heap_start = ALIGN(<span class="number">0x1000</span>);
}</code></pre>
<h4 id="阅读makefile">阅读 Makefile</h4>
<p>Check environment and arguments:</p>
<pre><code class="highlight makefile"><span class="comment">### Override checks when `make clean/clean-all/html`</span>
<span class="keyword">ifeq</span> (<span class="variable">$(<span class="built_in">findstring</span> <span class="variable">$(MAKECMDGOALS)</span>,clean|clean-all|html)</span>,)

<span class="comment">### Print build info message</span>
<span class="variable">$(info # Building <span class="variable">$(NAME)</span>-<span class="variable">$(MAKECMDGOALS)</span> [<span class="variable">$(ARCH)</span>])</span>

//...

<span class="comment">### Check: environment variable `$ARCH` must be in the supported list</span>
ARCHS = <span class="variable">$(<span class="built_in">basename</span> $(<span class="built_in">notdir</span> $(<span class="built_in">shell</span> ls <span class="variable">$(AM_HOME)</span>/scripts/*.mk)</span>))
<span class="keyword">ifeq</span> (<span class="variable">$(<span class="built_in">filter</span> <span class="variable">$(ARCHS)</span>, <span class="variable">$(ARCH)</span>)</span>, )
  <span class="variable">$(<span class="built_in">error</span> Expected $$ARCH in {<span class="variable">$(ARCHS)</span>}, Got <span class="string">"<span class="variable">$(ARCH)</span>"</span>)</span>
<span class="keyword">endif</span>

<span class="comment">### Checks end here</span>
<span class="keyword">endif</span></code></pre>
<p>Include AM makefile specified by <code>$(ARCH)</code>:</p>
<pre><code class="highlight makefile"><span class="keyword">-include</span> <span class="variable">$(AM_HOME)</span>/scripts/<span class="variable">$(ARCH)</span>.mk</code></pre>
<p>​ in $(ARCH).mk,</p>
<p>​ it includes <code>nemu.mk</code>, which builds NEMU related driver
and runs NEMU.</p>
<p>​ it also includes another arch related .mk that overwrites
<code>ARCH_H</code>.</p>
<pre><code class="highlight makefile"><span class="keyword">include</span> <span class="variable">$(AM_HOME)</span>/scripts/isa/riscv.mk
<span class="keyword">include</span> <span class="variable">$(AM_HOME)</span>/scripts/platform/nemu.mk
CFLAGS  += -DISA_H=\<span class="string">"riscv/riscv.h\"</span>
<span class="string"></span>
<span class="string">AM_SRCS += riscv/nemu/start.S \</span>
<span class="string">           riscv/nemu/cte.c \</span>
<span class="string">           riscv/nemu/trap.S \</span>
<span class="string">           riscv/nemu/vme.c</span></code></pre>
<p>Define compilation rule:</p>
<pre><code class="highlight makefile"><span class="comment">## 5. Compilation Rules</span>

<span class="comment">### Rule (compile): a single `.c` -&gt; `.o` (gcc)</span>
<span class="variable">$(DST_DIR)</span>/%.o: %.c
	@mkdir -p <span class="variable">$(<span class="built_in">dir</span> <span class="variable">$@</span>)</span> &amp;&amp; echo + CC <span class="variable">$&lt;</span>
	@<span class="variable">$(CC)</span> -std=gnu11 <span class="variable">$(CFLAGS)</span> -c -o <span class="variable">$@</span> <span class="variable">$(<span class="built_in">realpath</span> <span class="variable">$&lt;</span>)</span>

<span class="comment">### Rule (compile): a single `.cc` -&gt; `.o` (g++)</span>
<span class="variable">$(DST_DIR)</span>/%.o: %.cc
	@mkdir -p <span class="variable">$(<span class="built_in">dir</span> <span class="variable">$@</span>)</span> &amp;&amp; echo + CXX <span class="variable">$&lt;</span>
	@<span class="variable">$(CXX)</span> -std=c++17 <span class="variable">$(CXXFLAGS)</span> -c -o <span class="variable">$@</span> <span class="variable">$(<span class="built_in">realpath</span> <span class="variable">$&lt;</span>)</span>

<span class="comment">### Rule (compile): a single `.cpp` -&gt; `.o` (g++)</span>
<span class="variable">$(DST_DIR)</span>/%.o: %.cpp
	@mkdir -p <span class="variable">$(<span class="built_in">dir</span> <span class="variable">$@</span>)</span> &amp;&amp; echo + CXX <span class="variable">$&lt;</span>
	@<span class="variable">$(CXX)</span> -std=c++17 <span class="variable">$(CXXFLAGS)</span> -c -o <span class="variable">$@</span> <span class="variable">$(<span class="built_in">realpath</span> <span class="variable">$&lt;</span>)</span>

<span class="comment">### Rule (compile): a single `.S` -&gt; `.o` (gcc, which preprocesses and calls as)</span>
<span class="variable">$(DST_DIR)</span>/%.o: %.S
	@mkdir -p <span class="variable">$(<span class="built_in">dir</span> <span class="variable">$@</span>)</span> &amp;&amp; echo + AS <span class="variable">$&lt;</span>
	@<span class="variable">$(AS)</span> <span class="variable">$(ASFLAGS)</span> -c -o <span class="variable">$@</span> <span class="variable">$(<span class="built_in">realpath</span> <span class="variable">$&lt;</span>)</span>

<span class="comment">### Rule (recursive make): build a dependent library (am, klib, ...)</span>
<span class="variable">$(LIBS)</span>: %:
	@<span class="variable">$(MAKE)</span> -s -C <span class="variable">$(AM_HOME)</span>/<span class="variable">$*</span> archive

<span class="comment">### Rule (link): objects (`*.o`) and libraries (`*.a`) -&gt; `IMAGE.elf`, the final ELF binary to be packed into image (ld)</span>
<span class="variable">$(IMAGE)</span>.elf: <span class="variable">$(LINKAGE)</span> <span class="variable">$(LDSCRIPTS)</span>
	@echo \<span class="comment"># Creating image [$(ARCH)]</span>
	@echo + LD <span class="string">"-&gt;"</span> <span class="variable">$(IMAGE_REL)</span>.elf
<span class="keyword">ifneq</span> (<span class="variable">$(<span class="built_in">filter</span> <span class="variable">$(ARCH)</span>,native)</span>,)
	@<span class="variable">$(CXX)</span> -o <span class="variable">$@</span> -Wl,--whole-archive <span class="variable">$(LINKAGE)</span> -Wl,-no-whole-archive <span class="variable">$(LDFLAGS_CXX)</span>
<span class="keyword">else</span>
	@<span class="variable">$(LD)</span> <span class="variable">$(LDFLAGS)</span> -o <span class="variable">$@</span> --start-group <span class="variable">$(LINKAGE)</span> --end-group
<span class="keyword">endif</span>

<span class="comment">### Rule (archive): objects (`*.o`) -&gt; `ARCHIVE.a` (ar)</span>
<span class="variable">$(ARCHIVE)</span>: <span class="variable">$(OBJS)</span>
	@echo + AR <span class="string">"-&gt;"</span> <span class="variable">$(<span class="built_in">shell</span> <span class="built_in">realpath</span> <span class="variable">$@</span> --relative-to .)</span>
	@<span class="variable">$(AR)</span> rcs <span class="variable">$@</span> <span class="variable">$^</span>

<span class="comment">### Rule (`#include` dependencies): paste in `.d` files generated by gcc on `-MMD`</span>
<span class="keyword">-include</span> <span class="variable">$(<span class="built_in">addprefix</span> <span class="variable">$(DST_DIR)</span>/, $(<span class="built_in">addsuffix</span> .d, $(<span class="built_in">basename</span> <span class="variable">$(SRCS)</span>)</span>))</code></pre>
<p>Build the project in order below</p>
<pre><code class="highlight makefile"><span class="section">image: image-dep</span>
<span class="section">archive: <span class="variable">$(ARCHIVE)</span></span>
<span class="section">image-dep: <span class="variable">$(LIBS)</span> <span class="variable">$(IMAGE)</span>.elf</span>
<span class="section">.NOTPARALLEL: image-dep</span>
<span class="meta"><span class="keyword">.PHONY</span>: image image-dep archive run $(LIBS)</span></code></pre>
<pre><code class="highlight shell"><span class="meta prompt_"># </span><span class="language-bash">Building add-run [riscv64-nemu]</span>
<span class="meta prompt_"># </span><span class="language-bash">Building am-archive [riscv64-nemu]</span>
<span class="meta prompt_"># </span><span class="language-bash">Building klib-archive [riscv64-nemu]</span>
+ CC tests/add.c
<span class="meta prompt_"># </span><span class="language-bash">Creating image [riscv64-nemu]</span>
+ LD -&gt; build/add-riscv64-nemu.elf
+ OBJCOPY -&gt; build/add-riscv64-nemu.bin</code></pre>
<h3 id="实现常用的库函数">实现常用的库函数</h3>
<h4 id="stdarg是如何实现的">stdarg 是如何实现的？</h4>
<p>在</p>
<p>参考 <code>GNU/gcc-15.2.0</code> 中 <code>i386</code> 的实现：</p>
<p>计算固定参数的大小</p>
<pre><code class="highlight c"><span class="comment">//gcc-15.2.0/gcc/config/i386/i386.cc</span>

  <span class="comment">/* Count number of gp and fp argument registers used.  */</span>
  words = crtl-&gt;args.info.words;
  n_gpr = crtl-&gt;args.info.regno;
  n_fpr = crtl-&gt;args.info.sse_regno;

  <span class="keyword">if</span> (cfun-&gt;va_list_gpr_size)
    {
      type = TREE_TYPE (gpr);
      t = build2 (MODIFY_EXPR, type,
		  gpr, build_int_cst (type, n_gpr * <span class="number">8</span>));
      TREE_SIDE_EFFECTS (t) = <span class="number">1</span>;
      expand_expr (t, const0_rtx, VOIDmode, EXPAND_NORMAL);
    }

  <span class="keyword">if</span> (TARGET_SSE &amp;&amp; cfun-&gt;va_list_fpr_size)
    {
      type = TREE_TYPE (fpr);
      t = build2 (MODIFY_EXPR, type, fpr,
		  build_int_cst (type, n_fpr * <span class="number">16</span> + <span class="number">8</span>*X86_64_REGPARM_MAX));
      TREE_SIDE_EFFECTS (t) = <span class="number">1</span>;
      expand_expr (t, const0_rtx, VOIDmode, EXPAND_NORMAL);
    }</code></pre>
<p>处理栈上的 overflow area, register save area.</p>
<pre><code class="highlight c"> <span class="comment">/* Find the overflow area.  */</span>
 type = TREE_TYPE (ovf);
 <span class="keyword">if</span> (cfun-&gt;machine-&gt;split_stack_varargs_pointer == NULL_RTX)
   ovf_rtx = crtl-&gt;args.internal_arg_pointer;
 <span class="keyword">else</span>
   ovf_rtx = cfun-&gt;machine-&gt;split_stack_varargs_pointer;
 t = make_tree (type, ovf_rtx);
 <span class="keyword">if</span> (words != <span class="number">0</span>)
   t = fold_build_pointer_plus_hwi (t, words * UNITS_PER_WORD);

 t = build2 (MODIFY_EXPR, type, ovf, t);
 TREE_SIDE_EFFECTS (t) = <span class="number">1</span>;
 expand_expr (t, const0_rtx, VOIDmode, EXPAND_NORMAL);

 <span class="keyword">if</span> (ix86_varargs_gpr_size || ix86_varargs_fpr_size)
   {
     <span class="comment">/* Find the register save area.</span>
<span class="comment"> Prologue of the function save it right above stack frame.  */</span>
     type = TREE_TYPE (sav);
     t = make_tree (type, frame_pointer_rtx);
     <span class="keyword">if</span> (!ix86_varargs_gpr_size)
t = fold_build_pointer_plus_hwi (t, <span class="number">-8</span> * X86_64_REGPARM_MAX);

     t = build2 (MODIFY_EXPR, type, sav, t);
     TREE_SIDE_EFFECTS (t) = <span class="number">1</span>;
     expand_expr (t, const0_rtx, VOIDmode, EXPAND_NORMAL);
   }</code></pre>
<h3 id="基础设施2">基础设施 (2)</h3>
<h4 id="指令环形缓冲区---iringbuf">指令环形缓冲区 - iringbuf</h4>
<p>实现一个环形缓冲区，每次执行指令时写入即可</p>
<pre><code class="highlight c"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span></span>
<span class="class">{</span>
  <span class="type">char</span> buf[<span class="number">10</span>][<span class="number">128</span>];
  <span class="type">int</span> head;
  <span class="type">int</span> tail;
} LogRingbuf;

IFDEF(CONFIG_ITRACE, LogRingbuf ringbuf);

<span class="type">void</span> <span class="title function_">ringbuf_push</span><span class="params">(LogRingbuf *r, <span class="type">const</span> <span class="type">char</span>* <span class="built_in">log</span>)</span> {
  <span class="built_in">strcpy</span>(r-&gt;buf[r-&gt;head], <span class="built_in">log</span>);
  r-&gt;head = (r-&gt;head+<span class="number">1</span>) % <span class="number">10</span>;
  <span class="keyword">if</span>(r-&gt;head == r-&gt;tail) r-&gt;tail = (r-&gt;tail+<span class="number">1</span>) % <span class="number">10</span>;
}

<span class="type">void</span> <span class="title function_">ringbuf_puts</span><span class="params">(LogRingbuf *r)</span> {
  <span class="keyword">for</span>(<span class="type">int</span> i = r-&gt;tail; i!=r-&gt;head; i = (i+<span class="number">1</span>)%<span class="number">10</span>) {
    <span class="built_in">printf</span>(<span class="string">"%s\n"</span>, r-&gt;buf[i]);
  }
}</code></pre>
<h4 id="函数调用的踪迹---ftrace">函数调用的踪迹 - ftrace</h4>
<p>偷懒了，并没有完全实现（</p>
<p>先读取传入的 ELF:</p>
<pre><code class="highlight c"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;common.h&gt;</span></span>
<span class="meta">#<span class="keyword">include</span> <span class="string">&lt;elf.h&gt;</span></span>
<span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span>
<span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span>
<span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span>

<span class="type">void</span> <span class="title function_">init_ftrace</span><span class="params">(<span class="type">const</span> <span class="type">char</span>* elf)</span> {
  Elf64_Ehdr elf_header;
  FILE *fp = fopen(elf, <span class="string">"rb"</span>);
  <span class="keyword">if</span> (fp == <span class="literal">NULL</span>) {
    <span class="built_in">printf</span>(<span class="string">"Failed to open file %s\n"</span>, elf);
    <span class="keyword">return</span>;
  }
  <span class="type">size_t</span> count = fread(&amp;elf_header, <span class="number">1</span>, <span class="keyword">sizeof</span>(Elf64_Ehdr), fp);
  assert(count == <span class="keyword">sizeof</span>(Elf64_Ehdr));

  parse_symbols(fp, &amp;elf_header);
}</code></pre>
<p>根据 ELF 的结构，我们先读取 <code>Elf64_Ehdr</code>:</p>
<figure>
<img src="/PA1/68747470733a2f2f692e696d6775722e636f6d2f4169394f714f422e706e67.png" alt="ELF">
<figcaption aria-hidden="true">ELF</figcaption>
</figure>
<pre><code class="highlight plaintext">ELF header (Ehdr)
    The ELF header is described by the type Elf32_Ehdr or Elf64_Ehdr:

        #define EI_NIDENT 16

        typedef struct {
            unsigned char e_ident[EI_NIDENT];
            uint16_t      e_type;
            uint16_t      e_machine;
            uint32_t      e_version;
            ElfN_Addr     e_entry;
            ElfN_Off      e_phoff;
            ElfN_Off      e_shoff;
            uint32_t      e_flags;
            uint16_t      e_ehsize;
            uint16_t      e_phentsize;
            uint16_t      e_phnum;
            uint16_t      e_shentsize;
            uint16_t      e_shnum;
            uint16_t      e_shstrndx;
        } ElfN_Ehdr;</code></pre>
<p>解析具体的符号表，并维护一个单向链表：</p>
<pre><code class="highlight c"><span class="type">void</span> <span class="title function_">parse_symbols</span><span class="params">(FILE *fp, Elf64_Ehdr *elf_header)</span> {
  Elf64_Shdr *sh_table = <span class="built_in">malloc</span>(elf_header-&gt;e_shnum * <span class="keyword">sizeof</span>(Elf64_Shdr));
  fseek(fp, elf_header-&gt;e_shoff, SEEK_SET);
  <span class="type">size_t</span> ret = fread(sh_table, <span class="keyword">sizeof</span>(Elf64_Shdr), elf_header-&gt;e_shnum, fp);
  assert(ret == elf_header-&gt;e_shnum);

  Elf64_Shdr *symtab_shdr = <span class="literal">NULL</span>;
  Elf64_Shdr *strtab_shdr = <span class="literal">NULL</span>;

  <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; elf_header-&gt;e_shnum; i++) {
    <span class="keyword">if</span> (sh_table[i].sh_type == SHT_SYMTAB) {
      symtab_shdr = &amp;sh_table[i];
      <span class="keyword">if</span> (symtab_shdr-&gt;sh_link &lt; elf_header-&gt;e_shnum) {
        strtab_shdr = &amp;sh_table[symtab_shdr-&gt;sh_link];
      }
      <span class="keyword">break</span>;
    }
  }

  <span class="keyword">if</span> (!symtab_shdr || !strtab_shdr) {
    <span class="built_in">printf</span>(<span class="string">"Symbol table or string table not found.\n"</span>);
    <span class="built_in">free</span>(sh_table);
    <span class="keyword">return</span>;
  }

  Elf64_Sym *sym_table = <span class="built_in">malloc</span>(symtab_shdr-&gt;sh_size);
  fseek(fp, symtab_shdr-&gt;sh_offset, SEEK_SET);
  ret = fread(sym_table, symtab_shdr-&gt;sh_size, <span class="number">1</span>, fp);
  assert(ret == <span class="number">1</span>);

  <span class="type">char</span> *strtab = <span class="built_in">malloc</span>(strtab_shdr-&gt;sh_size);
  fseek(fp, strtab_shdr-&gt;sh_offset, SEEK_SET);
  ret = fread(strtab, strtab_shdr-&gt;sh_size, <span class="number">1</span>, fp);
  assert(ret == <span class="number">1</span>);


  <span class="type">int</span> num_symbols = symtab_shdr-&gt;sh_size / <span class="keyword">sizeof</span>(Elf64_Sym);
  <span class="comment">//printf("Parsing %d symbols...\n", num_symbols);</span>

  <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; num_symbols; i++) {
    <span class="type">const</span> <span class="type">char</span> *symbol_name = &amp;strtab[sym_table[i].st_name];
    Elf64_Addr symbol_addr = sym_table[i].st_value;
    <span class="type">unsigned</span> <span class="type">char</span> symbol_type = ELF64_ST_TYPE(sym_table[i].st_info);

    <span class="keyword">if</span> (symbol_type == STT_FUNC) {
<span class="comment">//      printf("Found function: %s at address 0x%lx\n", symbol_name, symbol_addr);</span>
      ftrace_append(symbol_name, symbol_addr);
    }
  }

  <span class="built_in">free</span>(sh_table);
  <span class="built_in">free</span>(sym_table);
  <span class="built_in">free</span>(strtab);
}</code></pre>
<p>Section header 中存放了各个 section 的信息</p>
<pre><code class="highlight plaintext">Section header (Shdr)
    A file's section header table lets one locate all the file's sections.  The section header table is an array of Elf32_Shdr or Elf64_Shdr structures.  The ELF
    header's e_shoff member gives the byte offset from the beginning of the file to the section header table.  e_shnum holds the number of  entries  the  section
    header table contains.  e_shentsize holds the size in bytes of each entry.

    A  section  header  table  index  is  a subscript into this array.  Some section header table indices are reserved: the initial entry and the indices between
    SHN_LORESERVE and SHN_HIRESERVE.  The initial entry is used in ELF extensions for e_phnum, e_shnum, and e_shstrndx; in other cases, each field in the initial
    entry is set to zero.  An object file does not have sections for these special indices:

    SHN_UNDEF
           This value marks an undefined, missing, irrelevant, or otherwise meaningless section reference.

    SHN_LORESERVE
           This value specifies the lower bound of the range of reserved indices.

    SHN_LOPROC
    SHN_HIPROC
           Values greater in the inclusive range [SHN_LOPROC, SHN_HIPROC] are reserved for processor-specific semantics.

    SHN_ABS
           This value specifies the absolute value for the corresponding reference.  For example, a symbol defined relative to section number SHN_ABS has an  ab‐
           solute value and is not affected by relocation.

    SHN_COMMON
           Symbols defined relative to this section are common symbols, such as FORTRAN COMMON or unallocated C external variables.

    SHN_HIRESERVE
           This  value  specifies  the upper bound of the range of reserved indices.  The system reserves indices between SHN_LORESERVE and SHN_HIRESERVE, inclu‐
           sive.  The section header table does not contain entries for the reserved indices.
</code></pre>
<p><code>Elf64_Sym</code> 的定义如下:</p>
<pre><code class="highlight plaintext">  String and symbol tables
      String table sections hold null-terminated character sequences, commonly called strings. The ob‐
      ject file uses these strings to represent symbol and section names. One references a string as
      an index into the string table section.  The first byte, which is index zero, is defined to  hold
      a null byte ('\0'). Similarly, a string table's last byte is defined to hold a null byte, ensur‐
      ing null termination for all strings.

      An  object file's symbol table holds information needed to locate and relocate a program's sym‐
      bolic definitions and references. A symbol table index is a subscript into this array.

typedef struct {
              uint32_t      st_name;
              //This member holds an index into the object file's symbol string table, which holds character representations of the symbol names. If the value is nonzero, it represents a string table index that gives the symbol name. Otherwise, the symbol has no name.
              unsigned char st_info;
              unsigned char st_other;
              uint16_t      st_shndx;
              Elf64_Addr    st_value;
              uint64_t      st_size;
          } Elf64_Sym;
</code></pre>
<p>后面遇到 <code>jal</code> 等跳转指令查找这个链表，计算偏移就可以了。</p>
<h4 id="differential-testing">Differential Testing</h4>
<p>框架已经实现好了相应的接口，实现一下比较寄存器的值</p>
<pre><code class="highlight c"><span class="type">bool</span> <span class="title function_">isa_difftest_checkregs</span><span class="params">(CPU_state *ref_r, <span class="type">vaddr_t</span> pc)</span> {
  <span class="type">bool</span> ok = <span class="literal">true</span>;
<span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">32</span>;i++) {
  <span class="keyword">if</span>(ref_r-&gt;gpr[i] != cpu.gpr[i]) {
    <span class="built_in">printf</span>(<span class="string">"\n [difftest] inequal reg value in %s: 0x%lx\n"</span>, regs[i], ref_r-&gt;gpr[i]);
    ok = <span class="literal">false</span>;
  }
}
  <span class="keyword">if</span>(ref_r-&gt;pc != cpu.pc) {
    <span class="built_in">printf</span>(<span class="string">"\n [difftest] inequal pc: 0x%lx\n"</span>,ref_r-&gt;pc);
    ok = <span class="literal">false</span>;
  }
  <span class="keyword">return</span> ok;
}</code></pre>
<h3 id="输入输出">输入输出</h3>
<p>实现需要的 IOE 功能都比较简单，这里在跑 <code>microbench</code> 的时候遇到了一个比较怪的问题。</p>
<p>difftest 提示</p>
<h1 id="references">References</h1>
<ul>
<li>https://lf-riscv.atlassian.net/wiki/spaces/HOME/pages/16154769/RISC-V+Technical+Specifications#ISA-Specifications</li>
<li>https://gcc.gnu.org/onlinedocs/gcc-15.1.0/gcc.pdf</li>
<li>https://elixir.bootlin.com/glibc/glibc-2.42.9000/source</li>
<li>https://gist.github.com/x0nu11byt3/bcb35c3de461e5fb66173071a2379779#file-elf_format_cheatsheet-md</li>
</ul>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/ICS/" rel="tag"><i class="fa fa-tag"></i> ICS</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/categories/CTF/vidarshare-fsop/" rel="prev" title="Vidar 分享会 - FSOP">
                  <i class="fa fa-angle-left"></i> Vidar 分享会 - FSOP
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/categories/CTF/easydma/" rel="next" title="QEMU PWN - EasyDMA">
                  QEMU PWN - EasyDMA <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">
<div class="custom-footer">
  <span>summ2's blog</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>

</body>
</html>
